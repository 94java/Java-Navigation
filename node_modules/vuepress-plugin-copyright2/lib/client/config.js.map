{"version":3,"file":"config.js","sources":["../../src/client/composables/setup.ts","../../src/client/config.ts"],"sourcesContent":["import { usePageFrontmatter, usePageData } from \"@vuepress/client\";\nimport { useEventListener } from \"@vueuse/core\";\nimport { computed, onMounted, watchEffect } from \"vue\";\n\nimport type { CopyrightPluginFrontmatter } from \"../../shared/index.js\";\n\ndeclare const COPYRIGHT_TRIGGER_WORDS: number;\ndeclare const COPYRIGHT_DISABLE_COPY: boolean;\ndeclare const COPYRIGHT_DISABLE_SELECTION: boolean;\ndeclare const COPYRIGHT_GLOBAL: boolean;\n\nexport const setupCopyright = (): void => {\n  const page = usePageData<{ copyright: string }>();\n  const frontmatter = usePageFrontmatter<CopyrightPluginFrontmatter>();\n\n  const enabled = computed(\n    () =>\n      Boolean(frontmatter.value.copy) ||\n      (frontmatter.value.copy !== false && COPYRIGHT_GLOBAL)\n  );\n\n  const disableCopy = computed(() => {\n    const frontmatterOptions = frontmatter.value.copy;\n\n    if (!enabled.value) return false;\n\n    if (\n      typeof frontmatterOptions === \"object\" &&\n      \"disableCopy\" in frontmatterOptions\n    )\n      return frontmatterOptions.disableCopy;\n\n    return COPYRIGHT_DISABLE_COPY;\n  });\n\n  const disableSelection = computed(() => {\n    const frontmatterOptions = frontmatter.value.copy;\n\n    if (!enabled.value) return false;\n\n    if (\n      typeof frontmatterOptions === \"object\" &&\n      \"disableSelection\" in frontmatterOptions\n    )\n      return frontmatterOptions.disableSelection;\n\n    return COPYRIGHT_DISABLE_SELECTION;\n  });\n\n  const onCopy = (event: ClipboardEvent): void => {\n    const selection = getSelection();\n\n    if (selection) {\n      const textRange = selection.getRangeAt(0);\n\n      if (enabled.value) {\n        if (disableCopy.value) {\n          event.preventDefault();\n\n          return;\n        }\n\n        if (textRange.toString().length >= COPYRIGHT_TRIGGER_WORDS) {\n          event.preventDefault();\n\n          const node = document.createElement(\"div\");\n\n          node.appendChild(selection.getRangeAt(0).cloneContents());\n\n          if (event.clipboardData) {\n            event.clipboardData.setData(\n              \"text/html\",\n              `${\n                node.innerHTML\n              }<hr><div class=\"copyright\">${page.value.copyright.replace(\n                /\\\\n/g,\n                \"<br>\"\n              )}</div>`\n            );\n            event.clipboardData.setData(\n              \"text/plain\",\n              `${\n                selection.getRangeAt(0).cloneContents().textContent || \"\"\n              }\\n------\\n${page.value.copyright}`\n            );\n          }\n        }\n      }\n    }\n  };\n\n  onMounted(() => {\n    const appElement = document.querySelector<HTMLDivElement>(\"#app\")!;\n\n    useEventListener(appElement, \"copy\", onCopy);\n\n    watchEffect(() => {\n      appElement.style.userSelect = disableSelection.value ? \"none\" : \"auto\";\n    });\n  });\n};\n","import { defineClientConfig } from \"@vuepress/client\";\nimport { setupCopyright } from \"./composables/index.js\";\n\nexport default defineClientConfig({\n  setup: () => {\n    setupCopyright();\n  },\n});\n"],"names":["setupCopyright","page","usePageData","frontmatter","usePageFrontmatter","enabled","computed","disableCopy","frontmatterOptions","disableSelection","onCopy","event","selection","textRange","node","onMounted","appElement","useEventListener","watchEffect","defineClientConfig"],"mappings":"8MAWa,MAAAA,EAAiB,IAAY,CACxC,MAAMC,EAAOC,IACPC,EAAcC,EAAAA,EAEdC,EAAUC,EACd,IACE,QAAQH,EAAY,MAAM,IAAI,GAC7BA,EAAY,MAAM,OAAS,IAAS,gBACzC,EAEMI,EAAcD,EAAS,IAAM,CACjC,MAAME,EAAqBL,EAAY,MAAM,KAE7C,OAAKE,EAAQ,MAGX,OAAOG,GAAuB,UAC9B,gBAAiBA,EAEVA,EAAmB,YAErB,uBARoB,EAS7B,CAAC,EAEKC,EAAmBH,EAAS,IAAM,CACtC,MAAME,EAAqBL,EAAY,MAAM,KAE7C,OAAKE,EAAQ,MAGX,OAAOG,GAAuB,UAC9B,qBAAsBA,EAEfA,EAAmB,iBAErB,4BARoB,EAS7B,CAAC,EAEKE,EAAUC,GAAgC,CAC9C,MAAMC,EAAY,eAElB,GAAIA,EAAW,CACb,MAAMC,EAAYD,EAAU,WAAW,CAAC,EAExC,GAAIP,EAAQ,MAAO,CACjB,GAAIE,EAAY,MAAO,CACrBI,EAAM,iBAEN,MACF,CAEA,GAAIE,EAAU,WAAW,QAAU,wBAAyB,CAC1DF,EAAM,iBAEN,MAAMG,EAAO,SAAS,cAAc,KAAK,EAEzCA,EAAK,YAAYF,EAAU,WAAW,CAAC,EAAE,cAAc,CAAC,EAEpDD,EAAM,gBACRA,EAAM,cAAc,QAClB,YACA,GACEG,EAAK,uCACuBb,EAAK,MAAM,UAAU,QACjD,OACA,MACF,SACF,EACAU,EAAM,cAAc,QAClB,aACA,GACEC,EAAU,WAAW,CAAC,EAAE,gBAAgB,aAAe;AAAA;AAAA,EAC5CX,EAAK,MAAM,WAC1B,EAEJ,CACF,CACF,CACF,EAEAc,EAAU,IAAM,CACd,MAAMC,EAAa,SAAS,cAA8B,MAAM,EAEhEC,EAAiBD,EAAY,OAAQN,CAAM,EAE3CQ,EAAY,IAAM,CAChBF,EAAW,MAAM,WAAaP,EAAiB,MAAQ,OAAS,MAClE,CAAC,CACH,CAAC,CACH,ECjGA,IAAeU,EAAAA,EAAmB,CAChC,MAAO,IAAM,CACXnB,EAAe,CACjB,CACF,CAAC"}