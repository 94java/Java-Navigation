{"version":3,"file":"theme.js","sourceRoot":"","sources":["../../src/node/theme.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,iBAAiB,CAAC;AACnD,OAAO,EAAE,KAAK,EAAE,MAAM,UAAU,CAAC;AAEjC,OAAO,EAAE,YAAY,EAAE,MAAM,YAAY,CAAC;AAC1C,OAAO,EAAE,qBAAqB,EAAE,MAAM,cAAc,CAAC;AACrD,OAAO,EACL,UAAU,EACV,kBAAkB,EAClB,mBAAmB,GACpB,MAAM,oBAAoB,CAAC;AAC5B,OAAO,EACL,qBAAqB,EACrB,SAAS,EACT,YAAY,GACb,MAAM,mBAAmB,CAAC;AAC3B,OAAO,EAAE,gBAAgB,EAAE,MAAM,wBAAwB,CAAC;AAC1D,OAAO,EAAE,WAAW,EAAE,MAAM,iBAAiB,CAAC;AAC9C,OAAO,EAAE,eAAe,EAAE,SAAS,EAAE,MAAM,oBAAoB,CAAC;AAChE,OAAO,EACL,iBAAiB,EACjB,kBAAkB,EAClB,uBAAuB,EACvB,qBAAqB,GACtB,MAAM,oBAAoB,CAAC;AAK5B,MAAM,SAAS,GAAG,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAE9C,MAAM,CAAC,MAAM,SAAS,GACpB,CACE,OAAqB;AACrB,iCAAiC;AACjC,MAAM,GAAG,KAAK,EACC,EAAE,CACnB,CAAC,GAAG,EAAE,EAAE;IACN,MAAM,EAAE,OAAO,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC;IAC5B,MAAM,EACJ,SAAS,GAAG,OAAO,EACnB,OAAO,GAAG,EAAE,EACZ,QAAQ,EACR,UAAU,EACV,UAAU,EACV,OAAO,EACP,SAAS,EACT,aAAa,EACb,MAAM,EACN,GAAG,YAAY,EAChB,GAAG,MAAM;QACR,CAAC,CAAC,mBAAmB,CAAC,OAAiD,CAAC;QACxE,CAAC,CAAC,OAAO,CAAC;IAEZ,IAAI,MAAM;QAAE,UAAU,CAAC,GAAG,CAAC,CAAC;IAE5B,MAAM,MAAM,GAAG,SAAS,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;IACvC,MAAM,WAAW,GAAG,YAAY,CAAC,GAAG,EAAE,YAAY,EAAE,MAAM,CAAC,CAAC;IAC5D,MAAM,KAAK,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,qBAAqB,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IAE1E,SAAS,CAAC,GAAG,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;IAEnC,IAAI,OAAO;QAAE,OAAO,CAAC,GAAG,CAAC,uBAAuB,EAAE,OAAO,CAAC,CAAC;IAE3D,OAAO;QACL,IAAI,EAAE,qBAAqB;QAE3B,KAAK,EAAE,YAAY,CAAC,OAAO,CAAC;QAE5B,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC;YACb,WAAW,EAAE,MAAM,CAAC,UAAU;YAC9B,mBAAmB,EAAE,MAAM,CAAC,iBAAiB;YAC7C,sBAAsB,EAAE,MAAM,CAAC,oBAAoB;YACnD,gBAAgB,EAAE,MAAM,CAAC,eAAe;SACzC,CAAC;QAEF,qBAAqB;QAErB,WAAW,EAAE,CAAC,IAAI,EAAQ,EAAE;YAC1B,IAAI,MAAM;gBACR,IAAI,CAAC,WAAW,GAAG,kBAAkB,CACnC,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,gBAAgB,IAAI,EAAE,CAC5B,CAAC;YAEJ,gBAAgB,CAAC,IAAI,EAAE,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;YAExC,WAAW,CACT,GAAG,EACkB,IAAI,EACzB,WAAW,EACX,MAAM,EACN,SAAS,IAAI,GAAG,CAAC,GAAG,CAAC,OAAO,CAC7B,CAAC;QACJ,CAAC;QAED,UAAU,EAAE,GAAkB,EAAE,CAC9B,OAAO,CAAC,GAAG,CAAC;YACV,kBAAkB,CAAC,GAAG,EAAE,WAAW,EAAE,aAAa,CAAC;YACnD,qBAAqB,CAAC,GAAG,EAAE,WAAW,CAAC;YACvC,uBAAuB,CAAC,GAAG,EAAE,KAAK,CAAC;SACpC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,CAAC;QAEvB,SAAS,EAAE,CAAC,GAAG,EAAE,QAAQ,EAAQ,EAAE;YACjC,IAAI,SAAS,EAAE;gBACb,+CAA+C;gBAC/C,MAAM,kBAAkB,GAAG,KAAK,CAAC,gBAAgB,EAAE;oBACjD,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE;oBACnB,aAAa,EAAE,IAAI;iBACpB,CAAC,CAAC;gBAEH,kBAAkB,CAAC,EAAE,CAAC,KAAK,EAAE,GAAG,EAAE;oBAChC,KAAK,kBAAkB,CAAC,GAAG,EAAE,WAAW,EAAE,aAAa,CAAC,CAAC;gBAC3D,CAAC,CAAC,CAAC;gBACH,kBAAkB,CAAC,EAAE,CAAC,QAAQ,EAAE,GAAG,EAAE;oBACnC,KAAK,kBAAkB,CAAC,GAAG,EAAE,WAAW,EAAE,aAAa,CAAC,CAAC;gBAC3D,CAAC,CAAC,CAAC;gBACH,kBAAkB,CAAC,EAAE,CAAC,QAAQ,EAAE,GAAG,EAAE;oBACnC,KAAK,kBAAkB,CAAC,GAAG,EAAE,WAAW,EAAE,aAAa,CAAC,CAAC;gBAC3D,CAAC,CAAC,CAAC;gBAEH,QAAQ,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;aACnC;QACH,CAAC;QAED,OAAO,EAAE,eAAe,CACtB,OAAO,EACP,WAAW;QAEX,aAAa;QACb;YACE,OAAO;YACP,SAAS;YACT,QAAQ;YACR,SAAS;YACT,UAAU;YACV,UAAU;YACV,MAAM;SACP,EACD,MAAM,CACP;QAED,aAAa,EAAE,IAAI,CAAC,OAAO,CACzB,SAAS,EACT,kCAAkC,CACnC;QAED,gBAAgB,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,iBAAiB,CAAC,GAAG,EAAE,MAAM,CAAC;KAC1D,CAAC;AACJ,CAAC,CAAC","sourcesContent":["import { getDirname, path } from \"@vuepress/utils\";\nimport { watch } from \"chokidar\";\n\nimport { resolveAlias } from \"./alias.js\";\nimport { extendsBundlerOptions } from \"./bundler.js\";\nimport {\n  checkStyle,\n  convertFrontmatter,\n  convertThemeOptions,\n} from \"./compact/index.js\";\nimport {\n  checkSocialMediaIcons,\n  getStatus,\n  getThemeData,\n} from \"./config/index.js\";\nimport { checkFrontmatter } from \"./frontmatter/index.js\";\nimport { extendsPage } from \"./page/index.js\";\nimport { getPluginConfig, usePlugin } from \"./plugins/index.js\";\nimport {\n  prepareConfigFile,\n  prepareSidebarData,\n  prepareSocialMediaIcons,\n  prepareThemeColorScss,\n} from \"./prepare/index.js\";\n\nimport type { Page, ThemeFunction } from \"@vuepress/core\";\nimport type { ThemeOptions, ThemePageData } from \"../shared/index.js\";\n\nconst __dirname = getDirname(import.meta.url);\n\nexport const hopeTheme =\n  (\n    options: ThemeOptions,\n    // TODO: Remove this in v2 stable\n    legacy = false\n  ): ThemeFunction =>\n  (app) => {\n    const { isDebug } = app.env;\n    const {\n      hotReload = isDebug,\n      plugins = {},\n      hostname,\n      iconAssets,\n      iconPrefix,\n      addThis,\n      backToTop,\n      sidebarSorter,\n      notice,\n      ...themeOptions\n    } = legacy\n      ? convertThemeOptions(options as ThemeOptions & Record<string, unknown>)\n      : options;\n\n    if (legacy) checkStyle(app);\n\n    const status = getStatus(app, options);\n    const themeConfig = getThemeData(app, themeOptions, status);\n    const icons = status.enableBlog ? checkSocialMediaIcons(themeConfig) : {};\n\n    usePlugin(app, plugins, hotReload);\n\n    if (isDebug) console.log(\"Theme plugin options:\", plugins);\n\n    return {\n      name: \"vuepress-theme-hope\",\n\n      alias: resolveAlias(isDebug),\n\n      define: () => ({\n        ENABLE_BLOG: status.enableBlog,\n        ENABLE_READING_TIME: status.enableReadingTime,\n        HAS_MULTIPLE_LANGUAGES: status.hasMultipleLanguages,\n        SUPPORT_PAGEVIEW: status.supportPageview,\n      }),\n\n      extendsBundlerOptions,\n\n      extendsPage: (page): void => {\n        if (legacy)\n          page.frontmatter = convertFrontmatter(\n            page.frontmatter,\n            page.filePathRelative || \"\"\n          );\n\n        checkFrontmatter(page, app.env.isDebug);\n\n        extendsPage(\n          app,\n          <Page<ThemePageData>>page,\n          themeConfig,\n          status,\n          hotReload || app.env.isBuild\n        );\n      },\n\n      onPrepared: (): Promise<void> =>\n        Promise.all([\n          prepareSidebarData(app, themeConfig, sidebarSorter),\n          prepareThemeColorScss(app, themeConfig),\n          prepareSocialMediaIcons(app, icons),\n        ]).then(() => void 0),\n\n      onWatched: (app, watchers): void => {\n        if (hotReload) {\n          // this ensure the page is generated or updated\n          const searchIndexWatcher = watch(\"pages/**/*.vue\", {\n            cwd: app.dir.temp(),\n            ignoreInitial: true,\n          });\n\n          searchIndexWatcher.on(\"add\", () => {\n            void prepareSidebarData(app, themeConfig, sidebarSorter);\n          });\n          searchIndexWatcher.on(\"change\", () => {\n            void prepareSidebarData(app, themeConfig, sidebarSorter);\n          });\n          searchIndexWatcher.on(\"unlink\", () => {\n            void prepareSidebarData(app, themeConfig, sidebarSorter);\n          });\n\n          watchers.push(searchIndexWatcher);\n        }\n      },\n\n      plugins: getPluginConfig(\n        plugins,\n        themeConfig,\n\n        // @ts-ignore\n        {\n          addThis,\n          backToTop,\n          hostname,\n          hotReload,\n          iconAssets,\n          iconPrefix,\n          notice,\n        },\n        legacy\n      ),\n\n      templateBuild: path.resolve(\n        __dirname,\n        \"../../templates/index.build.html\"\n      ),\n\n      clientConfigFile: (app) => prepareConfigFile(app, status),\n    };\n  };\n"]}