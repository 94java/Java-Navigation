{"version":3,"file":"timelines.js","sourceRoot":"","sources":["../../../../../src/client/modules/blog/composables/timelines.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AAChD,OAAO,EAAE,WAAW,EAAE,MAAM,8BAA8B,CAAC;AAC3D,OAAO,EAAE,OAAO,EAAE,MAAM,wBAAwB,CAAC;AAmBjD,MAAM,CAAC,MAAM,eAAe,GAC1B,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;AAE1B;;GAEG;AACH,MAAM,CAAC,MAAM,YAAY,GAAG,GAAiB,EAAE;IAC7C,MAAM,SAAS,GAAG,MAAM,CAAC,eAAe,CAAC,CAAC;IAE1C,IAAI,CAAC,SAAS,EAAE;QACd,MAAM,IAAI,KAAK,CAAC,4CAA4C,CAAC,CAAC;KAC/D;IAED,OAAO,SAAS,CAAC;AACnB,CAAC,CAAC;AAEF;;GAEG;AACH,MAAM,CAAC,MAAM,cAAc,GAAG,GAAS,EAAE;IACvC,MAAM,SAAS,GAAG,WAAW,CAAc,UAAU,CAAC,CAAC;IAEvD,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,EAAE;QAClC,MAAM,aAAa,GAAmB,EAAE,CAAC;QAEzC,qBAAqB;QACrB,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;YAC/C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,EAAE,GACxB,OAAO,CAAC,IAAI,gCAAsB,CAAC,EAAE,IAAI,IAAI,EAAE,CAAC;YAElD,IAAI,IAAI,IAAI,KAAK,IAAI,GAAG,EAAE;gBACxB,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,aAAa,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,IAAI;oBACrD,aAAa,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,CAAC;gBAE7C,aAAa,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC;oBAC1B,IAAI,EAAE,GAAG,KAAK,IAAI,GAAG,EAAE;oBACvB,IAAI;oBACJ,IAAI;iBACL,CAAC,CAAC;aACJ;QACH,CAAC,CAAC,CAAC;QAEH,OAAO;YACL,GAAG,SAAS,CAAC,KAAK;YAClB,MAAM,EAAE,aAAa,CAAC,OAAO,EAAE;SAChC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,OAAO,CAAC,eAAe,EAAE,aAAa,CAAC,CAAC;AAC1C,CAAC,CAAC","sourcesContent":["import { computed, inject, provide } from \"vue\";\nimport { useBlogType } from \"vuepress-plugin-blog2/client\";\nimport { getDate } from \"vuepress-shared/client\";\n\nimport { ArticleInfoType } from \"../../../../shared/index.js\";\n\nimport type { ComputedRef, InjectionKey } from \"vue\";\nimport type { Article } from \"vuepress-plugin-blog2/client\";\nimport type { ArticleInfo } from \"../../../../shared/index.js\";\n\nexport interface TimelineItem {\n  year: number;\n  items: { date: string; path: string; info: ArticleInfo }[];\n}\n\nexport type TimelinesRef = ComputedRef<{\n  path: string;\n  config: TimelineItem[];\n  items: Article<ArticleInfo>[];\n}>;\n\nexport const timelinesSymbol: InjectionKey<TimelinesRef> =\n  Symbol.for(\"timelines\");\n\n/**\n * Inject timelines\n */\nexport const useTimelines = (): TimelinesRef => {\n  const timelines = inject(timelinesSymbol);\n\n  if (!timelines) {\n    throw new Error(\"useTimelines() is called without provider.\");\n  }\n\n  return timelines;\n};\n\n/**\n * Provide timelines\n */\nexport const setupTimelines = (): void => {\n  const timelines = useBlogType<ArticleInfo>(\"timeline\");\n\n  const timelineItems = computed(() => {\n    const timelineItems: TimelineItem[] = [];\n\n    // filter before sort\n    timelines.value.items.forEach(({ info, path }) => {\n      const { year, month, day } =\n        getDate(info[ArticleInfoType.date])?.info || {};\n\n      if (year && month && day) {\n        if (!timelineItems[0] || timelineItems[0].year !== year)\n          timelineItems.unshift({ year, items: [] });\n\n        timelineItems[0].items.push({\n          date: `${month}/${day}`,\n          info,\n          path,\n        });\n      }\n    });\n\n    return {\n      ...timelines.value,\n      config: timelineItems.reverse(),\n    };\n  });\n\n  provide(timelinesSymbol, timelineItems);\n};\n"]}