{"version":3,"file":"resolveConfig.js","sourceRoot":"","sources":["../../../../../src/client/modules/sidebar/composables/resolveConfig.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-argument */\nimport { sidebarData } from \"@temp/theme-hope/sidebar\";\nimport {\n  usePageData,\n  usePageFrontmatter,\n  useRouteLocale,\n} from \"@vuepress/client\";\nimport {\n  isArray,\n  isLinkExternal,\n  isPlainObject,\n  isString,\n} from \"@vuepress/shared\";\nimport { useRoute } from \"vue-router\";\n\nimport {\n  useAutoLink,\n  useThemeLocaleData,\n} from \"@theme-hope/composables/index.js\";\nimport { resolvePrefix } from \"./utils.js\";\n\nimport type { PageHeader } from \"@vuepress/client\";\nimport type {\n  ResolvedSidebarItem,\n  ResolvedSidebarHeaderItem,\n  ResolvedSidebarPageItem,\n  ResolvedSidebarGroupItem,\n} from \"../utils/index.js\";\nimport type {\n  ThemeNormalPageFrontmatter,\n  SidebarArrayOptions,\n  SidebarObjectOptions,\n  SidebarItem,\n} from \"../../../../shared/index.js\";\n\n/**\n * Util to transform page header to sidebar item\n */\nexport const headerToSidebarItem = (\n  header: PageHeader,\n  headerDepth: number\n): ResolvedSidebarHeaderItem => {\n  const page = usePageData();\n\n  return {\n    type: \"heading\",\n    text: header.title,\n    link: `${page.value.path}#${header.slug}`,\n    children: headersToSidebarItemChildren(header.children, headerDepth),\n  };\n};\n\nexport const headersToSidebarItemChildren = (\n  headers: PageHeader[],\n  headerDepth: number\n): ResolvedSidebarHeaderItem[] =>\n  headerDepth > 0\n    ? headers.map((header) => headerToSidebarItem(header, headerDepth - 1))\n    : [];\n\n/**\n * Resolve sidebar items if the config is `heading`\n */\nexport const resolveHeadingSidebarItems = (\n  headerDepth: number\n): ResolvedSidebarHeaderItem[] => {\n  const page = usePageData();\n\n  return headersToSidebarItemChildren(page.value.headers, headerDepth);\n};\n\n/**\n * Resolve sidebar items if the config is an array\n */\nexport const resolveArraySidebarItems = (\n  sidebarConfig: SidebarArrayOptions,\n  headerDepth: number,\n  prefix = \"\"\n): ResolvedSidebarItem[] => {\n  const page = usePageData();\n  const route = useRoute();\n\n  const handleChildItem = (\n    item: SidebarItem,\n    pathPrefix = prefix\n  ): ResolvedSidebarPageItem | ResolvedSidebarGroupItem => {\n    const childItem = isString(item)\n      ? useAutoLink(resolvePrefix(pathPrefix, item))\n      : item.link\n      ? {\n          ...item,\n          ...(!isLinkExternal(item.link)\n            ? { link: useAutoLink(resolvePrefix(pathPrefix, item.link)).link }\n            : {}),\n        }\n      : item;\n\n    // resolved group item\n    if (\"children\" in childItem) {\n      const prefix = resolvePrefix(pathPrefix, childItem.prefix);\n\n      const children =\n        childItem.children === \"structure\"\n          ? sidebarData[prefix]\n          : childItem.children;\n\n      return {\n        type: \"group\",\n        ...childItem,\n        prefix,\n        children: children.map((item) => handleChildItem(item, prefix)),\n      };\n    }\n\n    return {\n      type: \"page\",\n      ...childItem,\n      children:\n        // if the sidebar item is current page and children is not set\n        // use headers of current page as children\n        childItem.link === route.path\n          ? headersToSidebarItemChildren(\n              // skip h1 header\n              page.value.headers[0]?.level === 1\n                ? page.value.headers[0].children\n                : page.value.headers,\n              headerDepth\n            )\n          : [],\n    };\n  };\n\n  return sidebarConfig.map((item) => handleChildItem(item));\n};\n\n/**\n * Resolve sidebar items if the config is a key -> value (path-prefix -> array) object\n */\nexport const resolveMultiSidebarItems = (\n  sidebarConfig: SidebarObjectOptions,\n  headerDepth: number\n): ResolvedSidebarItem[] => {\n  const route = useRoute();\n  const keys = Object.keys(sidebarConfig).sort((x, y) => y.length - x.length);\n\n  // find matching config\n  for (const base of keys) {\n    if (decodeURI(route.path).startsWith(base)) {\n      const matchedConfig = sidebarConfig[base];\n\n      return matchedConfig\n        ? resolveArraySidebarItems(\n            matchedConfig === \"structure\" ? sidebarData[base] : matchedConfig,\n            headerDepth,\n            base\n          )\n        : [];\n    }\n  }\n\n  console.warn(`${route.path} do not have valid sidebar config`);\n\n  return [];\n};\n\n/**\n * Resolve sidebar items global computed\n *\n * It should only be resolved and provided once\n */\nexport const resolveSidebarItems = (): ResolvedSidebarItem[] => {\n  const routeLocale = useRouteLocale();\n  const frontmatter = usePageFrontmatter<ThemeNormalPageFrontmatter>();\n  const themeLocale = useThemeLocaleData();\n\n  // get sidebar config from frontmatter > themeConfig\n  const sidebarConfig = frontmatter.value.home\n    ? false\n    : frontmatter.value.sidebar ?? themeLocale.value.sidebar ?? \"structure\";\n  const headerDepth =\n    frontmatter.value.headerDepth ?? themeLocale.value.headerDepth ?? 2;\n\n  // resolve sidebar items according to the config\n  return sidebarConfig === false\n    ? []\n    : sidebarConfig === \"heading\"\n    ? resolveHeadingSidebarItems(headerDepth)\n    : sidebarConfig === \"structure\"\n    ? resolveArraySidebarItems(\n        sidebarData[routeLocale.value],\n        headerDepth,\n        routeLocale.value\n      )\n    : isArray(sidebarConfig)\n    ? resolveArraySidebarItems(sidebarConfig, headerDepth)\n    : isPlainObject(sidebarConfig)\n    ? resolveMultiSidebarItems(sidebarConfig, headerDepth)\n    : [];\n};\n"]}