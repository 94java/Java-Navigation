import f from"mitt";import{provide as u,onMounted as v}from"vue";import{withBase as g}from"@vuepress/client";const p=Symbol.for("PWAEvent"),w=e=>{e.on("updatefound",()=>{navigator.serviceWorker.getRegistration().then(n=>{n&&n.active&&window.location.reload(!0)})})},h=async e=>{const{register:n}=await Promise.resolve().then(function(){return E});n(g(SW_PATH),{ready(t){console.log("[PWA]: Service worker is active"),e.emit("ready",t)},registered(t){console.log("[PWA]: Service worker has been registered."),e.emit("registered",t)},cached(t){console.log("[PWA]: Content has been cached for offline usage"),e.emit("cached",t)},async updatefound(t){await navigator.serviceWorker.getRegistration()&&(console.log("[PWA]: New content is downloading."),e.emit("updatefound",t))},updated(t){console.log("[PWA]: New content is available, please refresh.");const r="service-worker-version",o=Number(localStorage.getItem(r)||0);localStorage.setItem(r,(o+1).toString()),localStorage.removeItem("manifest"),e.emit("updated",t)},offline(){console.log("[PWA]: No internet connection found. App is running in offline mode."),e.emit("offline")},error(t){console.log("[PWA]: Error during service worker registration:",t),e.emit("error",t)}})},W=()=>{if(__VUEPRESS_SSR__)return;const e=f();u(p,e),v(async()=>{var n;if(__VUEPRESS_DEV__)return;let t=!1;(n=navigator.serviceWorker)!=null&&n.controller&&navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())}),SW_FORCE_UPDATE&&w(e),await h(e)})};var m=function(){return Boolean(window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))},c;typeof window<"u"&&(typeof Promise<"u"?c=new Promise(function(e){return window.addEventListener("load",e)}):c={then:function(e){return window.addEventListener("load",e)}});function S(e,n){n===void 0&&(n={});var t=n.registrationOptions;t===void 0&&(t={}),delete n.registrationOptions;var r=function(o){for(var s=[],a=arguments.length-1;a-- >0;)s[a]=arguments[a+1];n&&n[o]&&n[o].apply(n,s)};"serviceWorker"in navigator&&c.then(function(){m()?(y(e,r,t),navigator.serviceWorker.ready.then(function(o){r("ready",o)}).catch(function(o){return i(r,o)})):(l(e,r,t),navigator.serviceWorker.ready.then(function(o){r("ready",o)}).catch(function(o){return i(r,o)}))})}function i(e,n){navigator.onLine||e("offline"),e("error",n)}function l(e,n,t){navigator.serviceWorker.register(e,t).then(function(r){if(n("registered",r),r.waiting){n("updated",r);return}r.onupdatefound=function(){n("updatefound",r);var o=r.installing;o.onstatechange=function(){o.state==="installed"&&(navigator.serviceWorker.controller?n("updated",r):n("cached",r))}}}).catch(function(r){return i(n,r)})}function y(e,n,t){fetch(e).then(function(r){r.status===404?(n("error",new Error("Service worker not found at "+e)),d()):r.headers.get("content-type").indexOf("javascript")===-1?(n("error",new Error("Expected "+e+" to have javascript content-type, but received "+r.headers.get("content-type"))),d()):l(e,n,t)}).catch(function(r){return i(n,r)})}function d(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}).catch(function(e){return i(emit,e)})}var E=Object.freeze({__proto__:null,register:S,unregister:d});export{W as setupPWA};
//# sourceMappingURL=setup.js.map
