{"version":3,"file":"SWUpdatePopup.js","sources":["../../../src/client/define.ts","../../../src/client/components/icons.ts","../../../src/client/composables/usePWAEvent.ts","../../../src/client/composables/useSkipWaiting.ts","../../../src/client/components/SWUpdatePopup.ts"],"sourcesContent":["import type { PWALocaleConfig } from \"../shared/index.js\";\n\ndeclare const PWA_LOCALES: PWALocaleConfig;\n\nexport const locales = PWA_LOCALES;\n","import { h } from \"vue\";\nimport { IconBase } from \"vuepress-shared/client\";\n\nimport type { FunctionalComponent } from \"vue\";\n\nexport const ArrowLeftIcon: FunctionalComponent = () =>\n  h(\n    IconBase,\n    { name: \"arrow-left\" },\n\n    () =>\n      h(\"path\", {\n        d: \"M802.8 448h-428l166-158.8c23.8-25 23.8-65.4 0-90.4s-62.4-25-86.4 0L178 466.8c-12 11.6-18 27.4-18 44.8v0.8c0 17.4 6 33.2 18 44.8l276.2 268c24 25 62.6 25 86.4 0 23.8-25 23.8-65.4 0-90.4l-166-158.8h428c33.8 0 61.2-28.6 61.2-64 0.2-36-27.2-64-61-64z\",\n      })\n  );\n\nArrowLeftIcon.displayName = \"ArrowLeftIcon\";\n\nexport const ArrowRightIcon: FunctionalComponent = () =>\n  h(IconBase, { name: \"arrow-right\" }, () =>\n    h(\"path\", {\n      d: \"M569.8 825.2l276.2-268c12-11.6 18-27.4 18-44.8v-0.8c0-17.4-6-33.2-18-44.8l-276.2-268c-24-25-62.6-25-86.4 0-23.8 25-23.8 65.4 0 90.4l166 158.8h-428c-34 0-61.4 28.6-61.4 64 0 36 27.4 64 61.2 64h428l-166 158.8c-23.8 25-23.8 65.4 0 90.4 24 25 62.6 25 86.6 0z\",\n    })\n  );\n\nArrowRightIcon.displayName = \"ArrowRightIcon\";\n\nexport const CloseIcon: FunctionalComponent = () =>\n  h(IconBase, { name: \"close\" }, () =>\n    h(\"path\", {\n      d: \"M589.654 511.965 1007.212 84.22a49.777 49.777 0 0 0-.73-70.02 49.046 49.046 0 0 0-69.687.665L519.967 441.946 85.882 14.2a49.08 49.08 0 0 0-69.687.664 49.777 49.777 0 0 0 .664 70.019l433.454 427.082L16.859 939.048a49.777 49.777 0 0 0-.664 70.019 49.013 49.013 0 0 0 69.687.663l434.085-427.746 416.828 427.083A49.013 49.013 0 0 0 972.037 1024a48.416 48.416 0 0 0 34.512-14.27 49.777 49.777 0 0 0 .73-70.019z\",\n    })\n  );\n\nCloseIcon.displayName = \"CloseIcon\";\n\nexport const UpdateIcon: FunctionalComponent = () =>\n  h(IconBase, { name: \"update\" }, () =>\n    h(\"path\", {\n      d: \"M949.949 146.25v255.826c0 21.981-13.989 35.97-35.97 35.97H658.154c-13.988 0-25.983-7.992-33.973-21.981-5.997-13.989-4-27.977 7.991-39.97l79.942-77.946c-55.954-51.973-121.918-77.955-199.863-77.955-37.975 0-75.95 8.002-113.924 21.99-37.975 15.985-67.948 37.976-91.934 63.957-25.982 23.987-47.973 53.96-63.957 91.934-29.983 73.955-29.983 153.895 0 227.85 15.984 37.976 37.975 67.947 63.957 91.934 23.986 25.982 53.959 47.973 91.934 63.956 37.974 13.989 75.95 21.991 113.924 21.991 45.967 0 87.942-9.998 127.913-29.982 41.976-17.99 75.951-45.967 101.931-83.943 7.993-4 11.994-5.995 13.989-5.995 5.997 0 9.998 1.994 13.988 5.995l77.958 77.946c3.989 4 5.986 7.993 5.986 11.994 0 1.994-1.996 5.995-3.99 11.994-43.973 51.962-93.941 91.934-151.9 117.914-53.958 25.983-115.92 39.972-185.874 39.972-61.961 0-119.921-11.984-169.89-33.973-57.96-25.985-105.923-57.963-139.896-93.943-35.98-33.972-67.958-81.936-93.94-139.897-45.967-101.93-45.967-237.846 0-339.777 25.982-57.96 57.96-105.923 93.94-139.896 33.973-35.98 81.936-67.958 139.896-93.94 49.968-21.99 107.928-33.974 169.89-33.974 55.963 0 109.923 9.988 161.885 29.973 53.97 21.99 101.933 51.963 139.908 89.938l73.954-73.944c9.987-9.998 23.987-13.988 39.971-8.002 13.988 8.002 21.98 19.995 21.98 33.984z\",\n    })\n  );\n\nUpdateIcon.displayName = \"UpdateIcon\";\n","import { inject } from \"vue\";\nimport type { Emitter } from \"mitt\";\nimport type { InjectionKey } from \"vue\";\n\nexport type PWAEvent = Emitter<{\n  ready: ServiceWorkerRegistration;\n  registered: ServiceWorkerRegistration;\n  cached: ServiceWorkerRegistration;\n  updatefound: ServiceWorkerRegistration;\n  updated: ServiceWorkerRegistration;\n  offline: void;\n  error: Error;\n}>;\n\nexport const pwaEventSymbol: InjectionKey<PWAEvent> = Symbol.for(\"PWAEvent\");\n\nexport const usePWAEvent = (): PWAEvent => {\n  const pwaEvent = inject(pwaEventSymbol);\n\n  if (!pwaEvent) throw new Error(\"usePWAEvent() is called without provider.\");\n\n  return pwaEvent;\n};\n","/**\n * Call `skipWaiting()` inside current waiting worker\n */\nexport const useSkipWaiting = (\n  registration: ServiceWorkerRegistration\n): void => {\n  // get the waiting worker\n  const worker = registration.waiting;\n\n  // if there is no waiting worker, return directly\n  if (!worker) return;\n\n  // post SKIP_WAITING message to the waiting worker\n  const channel = new MessageChannel();\n\n  worker.postMessage({ type: \"SKIP_WAITING\" }, [channel.port2]);\n};\n","import { useLocaleConfig } from \"vuepress-shared/client\";\nimport { Transition, computed, defineComponent, h, onMounted, ref } from \"vue\";\nimport { locales } from \"../define.js\";\nimport { UpdateIcon } from \"../components/icons.js\";\nimport { usePWAEvent, useSkipWaiting } from \"../composables/index.js\";\n\nimport type { VNode } from \"vue\";\n\nimport \"../styles/popup.scss\";\n\nexport default defineComponent({\n  name: \"SWUpdatePopup\",\n\n  setup(_props, { slots }) {\n    const locale = useLocaleConfig(locales);\n    const registration = ref<ServiceWorkerRegistration>();\n\n    const enabled = computed(() => Boolean(registration.value));\n\n    const reload = (): void => {\n      if (registration.value) {\n        useSkipWaiting(registration.value);\n        registration.value = undefined;\n      }\n    };\n\n    onMounted(() => {\n      const event = usePWAEvent();\n\n      event.on(\"updated\", (reg) => {\n        if (reg) registration.value = reg;\n      });\n    });\n\n    return (): VNode =>\n      h(\n        Transition,\n        { name: \"popup\" },\n        () =>\n          slots[\"default\"]?.({\n            enabled: enabled.value,\n            reload,\n          }) ||\n          (enabled.value\n            ? h(\n                \"button\",\n                {\n                  class: \"sw-update-popup\",\n                  tabindex: 0,\n                  onClick: () => reload(),\n                },\n                [\n                  locale.value.update,\n                  h(\"span\", { class: \"icon-wrapper\" }, h(UpdateIcon)),\n                ]\n              )\n            : null)\n      );\n  },\n});\n"],"names":["locales","UpdateIcon","h","IconBase","pwaEventSymbol","usePWAEvent","pwaEvent","inject","useSkipWaiting","registration","worker","channel","defineComponent","_props","slots","locale","useLocaleConfig","ref","enabled","computed","reload","onMounted","reg","Transition","_a"],"mappings":"yPAIO,MAAMA,EAAU,YCgCVC,EAAkC,IAC7CC,EAAEC,EAAU,CAAE,KAAM,QAAS,EAAG,IAC9BD,EAAE,OAAQ,CACR,EAAG,+tCACL,CAAC,CACH,EAEFD,EAAW,YAAc,aC7BZ,MAAAG,EAAyC,OAAO,IAAI,UAAU,EAE9DC,EAAc,IAAgB,CACzC,MAAMC,EAAWC,EAAOH,CAAc,EAEtC,GAAI,CAACE,EAAU,MAAM,IAAI,MAAM,2CAA2C,EAE1E,OAAOA,CACT,ECnBaE,EACXC,GACS,CAET,MAAMC,EAASD,EAAa,QAG5B,GAAI,CAACC,EAAQ,OAGb,MAAMC,EAAU,IAAI,eAEpBD,EAAO,YAAY,CAAE,KAAM,cAAe,EAAG,CAACC,EAAQ,KAAK,CAAC,CAC9D,ECNA,IAAeC,EAAAA,EAAgB,CAC7B,KAAM,gBAEN,MAAMC,EAAQ,CAAE,MAAAC,CAAM,EAAG,CACvB,MAAMC,EAASC,EAAgBhB,CAAO,EAChCS,EAAeQ,IAEfC,EAAUC,EAAS,IAAM,QAAQV,EAAa,KAAK,CAAC,EAEpDW,EAAS,IAAY,CACrBX,EAAa,QACfD,EAAeC,EAAa,KAAK,EACjCA,EAAa,MAAQ,OAEzB,EAEA,OAAAY,EAAU,IAAM,CACAhB,IAER,GAAG,UAAYiB,GAAQ,CACvBA,IAAKb,EAAa,MAAQa,EAChC,CAAC,CACH,CAAC,EAEM,IACLpB,EACEqB,EACA,CAAE,KAAM,OAAQ,EAChB,IAAG,CAtCX,IAAAC,EAuCU,QAAAA,EAAAV,EAAM,UAAN,KAAAU,OAAAA,EAAA,KAAAV,EAAmB,CACjB,QAASI,EAAQ,MACjB,OAAAE,CACF,CAAA,KACCF,EAAQ,MACLhB,EACE,SACA,CACE,MAAO,kBACP,SAAU,EACV,QAAS,IAAMkB,GACjB,EACA,CACEL,EAAO,MAAM,OACbb,EAAE,OAAQ,CAAE,MAAO,cAAe,EAAGA,EAAED,CAAU,CAAC,CACpD,CACF,EACA,KACR,CAAA,CACJ,CACF,CAAC"}