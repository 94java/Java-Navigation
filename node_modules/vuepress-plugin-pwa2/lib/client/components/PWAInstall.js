import{h as e,defineComponent as m,ref as s,onMounted as g,computed as f}from"vue";import{IconBase as h,useLocaleConfig as w}from"vuepress-shared/client";import{useEventListener as I}from"@vueuse/core";import{withBase as k}from"@vuepress/client";import"../styles/modal.scss";const b=()=>e(h,{name:"arrow-left"},()=>e("path",{d:"M802.8 448h-428l166-158.8c23.8-25 23.8-65.4 0-90.4s-62.4-25-86.4 0L178 466.8c-12 11.6-18 27.4-18 44.8v0.8c0 17.4 6 33.2 18 44.8l276.2 268c24 25 62.6 25 86.4 0 23.8-25 23.8-65.4 0-90.4l-166-158.8h428c33.8 0 61.2-28.6 61.2-64 0.2-36-27.2-64-61-64z"}));b.displayName="ArrowLeftIcon";const A=()=>e(h,{name:"arrow-right"},()=>e("path",{d:"M569.8 825.2l276.2-268c12-11.6 18-27.4 18-44.8v-0.8c0-17.4-6-33.2-18-44.8l-276.2-268c-24-25-62.6-25-86.4 0-23.8 25-23.8 65.4 0 90.4l166 158.8h-428c-34 0-61.4 28.6-61.4 64 0 36 27.4 64 61.2 64h428l-166 158.8c-23.8 25-23.8 65.4 0 90.4 24 25 62.6 25 86.6 0z"}));A.displayName="ArrowRightIcon";const y=()=>e(h,{name:"close"},()=>e("path",{d:"M589.654 511.965 1007.212 84.22a49.777 49.777 0 0 0-.73-70.02 49.046 49.046 0 0 0-69.687.665L519.967 441.946 85.882 14.2a49.08 49.08 0 0 0-69.687.664 49.777 49.777 0 0 0 .664 70.019l433.454 427.082L16.859 939.048a49.777 49.777 0 0 0-.664 70.019 49.013 49.013 0 0 0 69.687.663l434.085-427.746 416.828 427.083A49.013 49.013 0 0 0 972.037 1024a48.416 48.416 0 0 0 34.512-14.27 49.777 49.777 0 0 0 .73-70.019z"}));y.displayName="CloseIcon";const C=PWA_LOCALES;var S=m({name:"PWAInstallModal",props:{useHint:Boolean},emits:{canInstall:c=>!0,hint:()=>!0,toggle:c=>!0},setup(c,{emit:o}){const n=w(C),l=s({}),i=s(),u=async()=>{const t=localStorage.getItem("manifest");if(t)l.value=JSON.parse(t);else try{const a=await(await fetch(k("manifest.webmanifest"))).json();l.value=a,localStorage.setItem("manifest",JSON.stringify(a))}catch{console.error("[PWA]: Error getting manifest, check that you have a valid web manifest or network connection")}},r=()=>{const t=document.querySelector(".screenshot");t&&t.scrollBy({left:-t.clientWidth,top:0,behavior:"smooth"})},v=()=>{const t=document.querySelector(".screenshot");t&&t.scrollBy({left:t.clientWidth,top:0,behavior:"smooth"})},d=async()=>{i.value&&(i.value.prompt(),document.dispatchEvent(new CustomEvent("show")),(await i.value.userChoice).outcome==="accepted"?(console.info("PWA has been installed"),o("toggle",!1),o("canInstall",!1)):(console.info("You choose to not install PWA"),o("toggle",!1),o("canInstall",!1)))},p=()=>{console.info("You accepted the install hint"),o("hint")};return g(()=>{window.hasOwnProperty("BeforeInstallPromptEvent")&&(I(window,"beforeinstallprompt",t=>{i.value=t,o("canInstall",!0),t.preventDefault(),I("keyup",a=>{a.key==="Escape"&&o("toggle",!1)})}),u())}),()=>{var t;return e("div",{id:"install-modal-wrapper"},[e("div",{class:"background",onClick:()=>o("toggle",!1)}),e("div",{class:"install-modal"},[e("div",{class:"header"},[e("button",{class:"close-button","aria-label":n.value.close,onClick:()=>o("toggle",!1)},e(y)),e("div",{class:"logo"},[l.value.icons?e("img",{src:(t=l.value.icons[0])==null?void 0:t.src,alt:"App Logo"}):null,e("div",{class:"title"},[e("h1",l.value.short_name||l.value.name),e("p",{class:"desc"},n.value.explain)])])]),e("div",{class:"content"},[e("div",{class:"highlight"},[l.value.features?e("div",{class:"feature-wrapper"},[e("h3",n.value.feature),e("ul",l.value.features.map(a=>e("li",a)))]):null,l.value.screenshots?e("div",{class:"screenshot-wrapper"},[e("button",{"aria-label":n.value.prevImage,onClick:r},e(b)),e("section",{class:"screenshot"},[l.value.screenshots.map(a=>e("div",e("img",{src:a.src,alt:"App Screenshot"})))]),e("button",{"aria-label":n.value.nextImage,onClick:v},e(A))]):null]),e("div",{class:"description"},[e("h3",n.value.desc),e("p",l.value.description)])]),c.useHint?e("div",{class:"ios-text",onClick:p},[e("p",n.value.iOSInstall),e("button",{class:"success"},"Got it!")]):e("div",{class:"button-wrapper"},[e("button",{class:"install-button",onClick:d},[n.value.install,e("span",l.value.short_name)]),e("button",{class:"cancel-button",onClick:()=>o("toggle",!1)},n.value.cancel)])])])}}}),P=m({name:"PWAInstall",setup(){const c=w(C),o=s(!1),n=s(!1),l=s(!1),i=s(!1),u=s(!1),r=s(!1),v=f(()=>i.value&&u.value&&r.value===!1),d=f(()=>n.value&&o.value||v.value),p=()=>navigator.standalone?navigator.standalone:matchMedia("(display-mode: standalone)").matches,t=()=>{l.value=!1,r.value=!0,localStorage.setItem("iOS-pwa-hint","hinted")};return g(()=>{if(p()){const{userAgent:a}=navigator;i.value=a.includes("iPhone")||a.includes("iPad")||Boolean(a.includes("Macintosh")&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2),u.value=navigator.userAgent.includes("Safari")&&!a.includes("Chrome"),r.value=Boolean(localStorage.getItem("iOS-pwa-hint"))}"getInstalledRelatedApps"in navigator&&navigator.getInstalledRelatedApps().then(a=>{n.value=a.length>0})}),()=>e("div",{id:"pwa-install"},[d.value?e("button",{class:"modal-button",useHint:v.value,onClick:()=>{l.value=!0}},c.value.install):null,e(S,{style:{display:l.value?"block":"none"},onCanInstall:a=>{o.value=a},onHint:()=>t(),onToggle:a=>{l.value=a}})])}});export{P as default};
//# sourceMappingURL=PWAInstall.js.map
