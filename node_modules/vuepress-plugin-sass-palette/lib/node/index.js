import{getDirname as D,path as $,fs as O}from"@vuepress/utils";import{watch as b}from"chokidar";import{mergeViteConfig as T,Logger as A}from"vuepress-shared/node";const E=(t,s,e)=>{var n,r,f;const{bundler:p}=s.options;if(p.name.endsWith("vite")){const i=t,l=(f=(r=(n=i.viteOptions)==null?void 0:n.css)==null?void 0:r.preprocessorOptions)==null?void 0:f.scss.additionalData;i.viteOptions=T(i.viteOptions||{},{css:{preprocessorOptions:{scss:{charset:!1,additionalData:async(u,o)=>{const c=typeof l=="string"?`${l}${u}`:typeof l=="function"?await l(u,o):u;return c.match(new RegExp(`@use\\s+["']@sass-palette\\/${e}-config["'];`))?c:`@use "@sass-palette/${e}-config";
${c}`}}}}})}if(p.name.endsWith("webpack")){const i=t;i.scss||(i.scss={});const{additionalData:l}=i.scss,u=(o,c)=>{const a=typeof l=="string"?`${l}${o}`:typeof l=="function"?l(o,c):o;return a.match(new RegExp(`@use\\s+["']@sass-palette\\/${e}-config["'];`))?a:`@use "@sass-palette/${e}-config";
${a}`};i.scss.additionalData=u}},F=D(import.meta.url),W=$.resolve(F,"../../styles/empty.scss"),m=new A("vuepress-plugin-sass-palette"),d=t=>O.pathExistsSync(t)?t:W,R=(t,s)=>t.writeTemp(`sass-palette/load-${s}.js`,`import "@sass-palette/${s}-inject";
export default {};
`),z=(t,s)=>t.writeTemp(`sass-palette/${s}-inject.scss`,`@use "sass:color";
@use "sass:list";
@use "sass:math";
@use "sass:map";
@use "sass:meta";

@use "@sass-palette/helper";
@use "@sass-palette/${s}-palette";

$variables: meta.module-variables("${s}-palette");
${t.env.isDebug?`
@debug "${s} palette variables: #{meta.inspect($variables)}";
@debug "${s} config variables: #{meta.inspect(meta.module-variables("${s}-config"))}";
`:""}

@each $name, $value in $variables {
  $key: helper.camel-to-kebab($name);

  @if meta.type-of($value) == number or meta.type-of($value) == string {
    :root {
      #{$key}: #{$value};
    }
  } @else if helper.color-is-legal($value) {
    @if meta.global-variable-exists("dark-selector", $module: "${s}-config") {
      @include helper.inject-color($key, $value, $dark-selector: ${s}-config.$dark-selector);
    } @else {
      @include helper.inject-color($key, $value);
    }
  }
}
`),S=(t,{id:s,defaultConfig:e,defaultPalette:n,generator:r,userConfig:f,userPalette:p})=>t.writeTemp(`sass-palette/${s}-config.scss`,`@import "file:///${d(n)}";
@import "file:///${d(e)}";
@import "file:///${d(p)}";
@import "file:///${d(f)}";
@import "file:///${d(r)}";
`),j=(t,{id:s,defaultPalette:e,generator:n,userPalette:r})=>t.writeTemp(`sass-palette/${s}-palette.scss`,`@import "file:///${d(e)}";
@import "file:///${d(r)}";
@import "file:///${d(n)}";
`),x=(t,{id:s,userStyle:e})=>e?t.writeTemp(`sass-palette/${s}-style.scss`,`@forward "file:///${d(e)}";
`):Promise.resolve(null),v=D(import.meta.url),I=t=>s=>{s.env.isDebug&&m.info(`Options: ${t.toString()}`);const{id:e="hope",config:n=`.vuepress/styles/${e}-config.scss`,defaultConfig:r=$.resolve(v,"../../styles/default/config.scss"),palette:f=`.vuepress/styles/${e}-palette.scss`,defaultPalette:p=$.resolve(v,"../../styles/default/palette.scss"),generator:i=$.resolve(v,"../../styles/empty.scss"),style:l=""}=t,u=s.dir.source(n),o=s.dir.source(f),c=l?s.dir.source(l):null;return{name:"vuepress-plugin-sass-palette",multiple:!0,id:e,alias:{["@sass-palette/helper"]:$.resolve(v,"../../styles/helper.scss"),[`@sass-palette/${e}-config`]:s.dir.temp(`sass-palette/${e}-config.scss`),[`@sass-palette/${e}-inject`]:s.dir.temp(`sass-palette/${e}-inject.scss`),[`@sass-palette/${e}-palette`]:s.dir.temp(`sass-palette/${e}-palette.scss`),...l?{[`@sass-palette/${e}-style`]:s.dir.temp(`sass-palette/${e}-style.scss`)}:{}},extendsBundlerOptions:(a,g)=>{E(a,g,e)},onInitialized:()=>Promise.all([z(s,e),S(s,{id:e,defaultConfig:r,defaultPalette:p,generator:i,userConfig:u,userPalette:o}),j(s,{id:e,defaultPalette:p,generator:i,userPalette:o}),x(s,{id:e,userStyle:c})]).then(()=>{s.env.isDebug&&m.info(`Style file for ${e} generated`)}),onWatched:(a,g)=>{const y=b(u,{cwd:a.dir.source(),ignoreInitial:!0}),w=()=>S(a,{id:e,defaultConfig:r,defaultPalette:p,generator:i,userConfig:u,userPalette:o}).then(()=>{a.env.isDebug&&m.info(`Style file for ${e} updated`)});y.on("add",()=>{w()}),y.on("unlink",()=>{w()}),g.push(y);const h=b(o,{cwd:a.dir.source(),ignoreInitial:!0}),C=()=>Promise.all([S(a,{id:e,defaultConfig:r,defaultPalette:p,generator:i,userConfig:u,userPalette:o}),j(a,{id:e,defaultPalette:p,generator:i,userPalette:o})]).then(()=>{a.env.isDebug&&m.info(`Style file for ${e} updated`)});if(h.on("add",()=>{C()}),h.on("unlink",()=>{C()}),g.push(h),c){const P=b(c,{cwd:a.dir.source(),ignoreInitial:!0}),k=()=>x(a,{id:e,userStyle:c}).then(()=>{a.env.isDebug&&m.info(`Style file for ${e} updated`)});P.on("add",()=>{k()}),P.on("unlink",()=>{k()}),g.push(P)}},clientConfigFile:a=>R(a,e)}},B=(t,s)=>{t.pluginApi.plugins.filter(e=>e.name==="vuepress-plugin-sass-palette").every(e=>e.id!==s.id)&&t.use(I(s))},L=(t,s)=>{const e=t.pluginApi.plugins.filter(n=>n.name==="vuepress-plugin-sass-palette").findIndex(n=>n.id===s);e!==-1&&t.pluginApi.plugins.splice(e,1)};export{L as removePalettePlugin,I as sassPalettePlugin,B as useSassPalettePlugin};
//# sourceMappingURL=index.js.map
