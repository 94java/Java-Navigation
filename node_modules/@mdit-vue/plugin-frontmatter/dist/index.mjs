import grayMatter from 'gray-matter';

const frontmatterPlugin = (md, { grayMatterOptions, renderExcerpt = true } = {}) => {
  const render = md.render.bind(md);
  md.render = (src, env = {}) => {
    const { data, content, excerpt = "" } = grayMatter(src, grayMatterOptions);
    env.content = content;
    env.frontmatter = {
      ...env.frontmatter,
      ...data
    };
    env.excerpt = renderExcerpt && excerpt ? render(excerpt, { ...env }) : excerpt;
    return render(content, env);
  };
};

export { frontmatterPlugin };
