{"version":3,"file":"Waline.js","sources":["../../../src/client/components/Waline.ts"],"sourcesContent":["import { usePageFrontmatter, usePageLang, withBase } from \"@vuepress/client\";\nimport { Waline } from \"@waline/client/dist/component.mjs\";\nimport { pageviewCount } from \"@waline/client/dist/pageview.mjs\";\nimport { computed, defineComponent, h, onMounted, watch } from \"vue\";\nimport { useRoute } from \"vue-router\";\nimport { useLocaleConfig } from \"vuepress-shared/client\";\n\nimport type { VNode } from \"vue\";\nimport type {\n  CommentPluginFrontmatter,\n  WalineLocaleConfig,\n  WalineOptions,\n} from \"../../shared/index.js\";\n\nimport \"@waline/client/dist/waline.css\";\nimport \"../styles/waline.scss\";\n\ndeclare const COMMENT_OPTIONS: WalineOptions;\n\ndeclare const WALINE_META: boolean;\ndeclare const WALINE_LOCALES: WalineLocaleConfig;\n\nconst walineOption = COMMENT_OPTIONS;\nconst walineLocales = WALINE_LOCALES;\nconst enableWaline = Boolean(walineOption.serverURL);\n\nif (WALINE_META) import(\"@waline/client/dist/waline-meta.css\");\n\nexport { pageviewCount };\n\nexport default defineComponent({\n  name: \"WalineComment\",\n\n  setup() {\n    const route = useRoute();\n    const frontmatter = usePageFrontmatter<CommentPluginFrontmatter>();\n    const lang = usePageLang();\n    const walineLocale = useLocaleConfig(walineLocales);\n\n    let abort: () => void;\n\n    const enableComment = computed(() => {\n      if (!enableWaline) return false;\n      const pluginConfig = walineOption.comment !== false;\n      const pageConfig = frontmatter.value.comment;\n\n      return (\n        // Enable in page\n        Boolean(pageConfig) ||\n        // not disabled in anywhere\n        (pluginConfig !== false && pageConfig !== false)\n      );\n    });\n\n    const enablePageViews = computed(() => {\n      if (!enableWaline) return false;\n      const pluginConfig = walineOption.pageview !== false;\n      const pageConfig = frontmatter.value.pageview;\n\n      return (\n        // Enable in page\n        Boolean(pageConfig) ||\n        // not disabled in anywhere\n        (pluginConfig !== false && pageConfig !== false)\n      );\n    });\n\n    const walineProps = computed(() => ({\n      lang: lang.value === \"zh-CN\" ? \"zh-CN\" : \"en\",\n      locale: {\n        ...walineLocale.value,\n        ...(walineOption.locale || {}),\n      },\n      emoji: [\n        \"//unpkg.com/@waline/emojis@1.1.0/weibo\",\n        \"//unpkg.com/@waline/emojis@1.1.0/bilibili\",\n      ],\n      dark: \"html.dark\",\n      ...walineOption,\n      path: withBase(route.path),\n    }));\n\n    onMounted(() => {\n      watch(\n        () => route.path,\n        () => {\n          abort?.();\n\n          if (enablePageViews.value)\n            setTimeout(() => {\n              abort = pageviewCount({\n                serverURL: walineOption.serverURL,\n                path: withBase(route.path),\n              });\n            }, walineOption.delay || 500);\n        },\n        { immediate: true }\n      );\n    });\n\n    return (): VNode | null =>\n      enableComment.value\n        ? h(\n            \"div\",\n            { class: \"waline-wrapper\" },\n            enableWaline ? h(Waline, walineProps.value) : []\n          )\n        : null;\n  },\n});\n"],"names":["walineOption","walineLocales","enableWaline","defineComponent","route","useRoute","frontmatter","usePageFrontmatter","lang","usePageLang","walineLocale","useLocaleConfig","abort","enableComment","computed","pluginConfig","pageConfig","enablePageViews","walineProps","withBase","onMounted","watch","pageviewCount","h","Waline"],"mappings":"2gBAsBA,MAAMA,EAAe,gBACfC,EAAgB,eAChBC,EAAe,QAAQF,EAAa,SAAS,EAE/C,aAAa,OAAO,uCAIxB,IAAeG,EAAAA,EAAgB,CAC7B,KAAM,gBAEN,OAAQ,CACN,MAAMC,EAAQC,EAAAA,EACRC,EAAcC,EAA6C,EAC3DC,EAAOC,EAAAA,EACPC,EAAeC,EAAgBV,CAAa,EAElD,IAAIW,EAEJ,MAAMC,EAAgBC,EAAS,IAAM,CACnC,GAAI,CAACZ,EAAc,MAAO,GAC1B,MAAMa,EAAef,EAAa,UAAY,GACxCgB,EAAaV,EAAY,MAAM,QAErC,OAEE,QAAQU,CAAU,GAEjBD,IAAiB,IAASC,IAAe,EAE9C,CAAC,EAEKC,EAAkBH,EAAS,IAAM,CACrC,GAAI,CAACZ,EAAc,MAAO,GAC1B,MAAMa,EAAef,EAAa,WAAa,GACzCgB,EAAaV,EAAY,MAAM,SAErC,OAEE,QAAQU,CAAU,GAEjBD,IAAiB,IAASC,IAAe,EAE9C,CAAC,EAEKE,EAAcJ,EAAS,KAAO,CAClC,KAAMN,EAAK,QAAU,QAAU,QAAU,KACzC,OAAQ,CACN,GAAGE,EAAa,MAChB,GAAIV,EAAa,QAAU,CAC7B,CAAA,EACA,MAAO,CACL,yCACA,2CACF,EACA,KAAM,YACN,GAAGA,EACH,KAAMmB,EAASf,EAAM,IAAI,CAC3B,EAAE,EAEF,OAAAgB,EAAU,IAAM,CACdC,EACE,IAAMjB,EAAM,KACZ,IAAM,CACJQ,GAAA,MAAAA,IAEIK,EAAgB,OAClB,WAAW,IAAM,CACfL,EAAQU,EAAc,CACpB,UAAWtB,EAAa,UACxB,KAAMmB,EAASf,EAAM,IAAI,CAC3B,CAAC,CACH,EAAGJ,EAAa,OAAS,GAAG,CAChC,EACA,CAAE,UAAW,EAAK,CACpB,CACF,CAAC,EAEM,IACLa,EAAc,MACVU,EACE,MACA,CAAE,MAAO,gBAAiB,EAC1BrB,EAAeqB,EAAEC,EAAQN,EAAY,KAAK,EAAI,CAChD,CAAA,EACA,IACR,CACF,CAAC"}