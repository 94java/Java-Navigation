{"version":3,"file":"Tabs.js","sources":["../../../src/client/components/Tabs.ts"],"sourcesContent":["import { ClientOnly } from \"@vuepress/client\";\nimport { useStorage } from \"@vueuse/core\";\nimport { defineComponent, h, ref, watch } from \"vue\";\nimport type { PropType, VNode } from \"vue\";\n\nimport \"../styles/tabs.scss\";\n\nexport interface TabProps extends Record<string, unknown> {\n  title: string;\n  value?: string;\n}\n\nconst tabStore = useStorage<Record<string, string>>(\"VUEPRESS_TAB_STORE\", {});\n\nexport default defineComponent({\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"Tabs\",\n\n  props: {\n    /**\n     * Active tab index\n     *\n     * 激活的标签页序号\n     */\n    active: {\n      type: Number,\n      default: 0,\n    },\n\n    /**\n     * tab data\n     *\n     * 标签页数据\n     */\n    data: {\n      type: Array as PropType<TabProps[]>,\n      required: true,\n    },\n\n    /**\n     * Tab id\n     *\n     * 标签页 id\n     */\n    id: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * tab id\n     *\n     * 标签页 id\n     */\n    tabId: {\n      type: String,\n      default: \"\",\n    },\n  },\n\n  setup(props, { slots }) {\n    const getInitialIndex = (): number => {\n      if (props.tabId) {\n        const valueIndex = props.data.findIndex(\n          ({ title, value = title }) => tabStore.value[props.tabId] === value\n        );\n\n        if (valueIndex !== -1) return valueIndex;\n      }\n\n      return props.active;\n    };\n\n    // index of current active item\n    const activeIndex = ref(getInitialIndex());\n\n    // refs of the tab buttons\n    const tabRefs = ref<HTMLUListElement[]>([]);\n\n    // update store\n    const updateStore = (): void => {\n      if (props.tabId) {\n        const { title, value = title } = props.data[activeIndex.value];\n\n        tabStore.value[props.tabId] = value;\n      }\n    };\n\n    // activate next tab\n    const activateNext = (index = activeIndex.value): void => {\n      activeIndex.value = index < tabRefs.value.length - 1 ? index + 1 : 0;\n      tabRefs.value[activeIndex.value].focus();\n    };\n\n    // activate previous tab\n    const activatePrev = (index = activeIndex.value): void => {\n      activeIndex.value = index > 0 ? index - 1 : tabRefs.value.length - 1;\n      tabRefs.value[activeIndex.value].focus();\n    };\n\n    // handle keyboard event\n    const keyboardHandler = (event: KeyboardEvent, index: number): void => {\n      if (event.key === \" \" || event.key === \"Enter\") {\n        event.preventDefault();\n        activeIndex.value = index;\n      } else if (event.key === \"ArrowRight\") {\n        event.preventDefault();\n        activateNext();\n      } else if (event.key === \"ArrowLeft\") {\n        event.preventDefault();\n        activatePrev();\n      }\n\n      updateStore();\n    };\n\n    watch(\n      () => tabStore.value[props.tabId],\n      (newValue, oldValue) => {\n        if (props.tabId && newValue !== oldValue) {\n          const index = props.data.findIndex(\n            ({ title, value = title }) => value === newValue\n          );\n\n          if (index !== -1) activeIndex.value = index;\n        }\n      }\n    );\n\n    return (): VNode | null =>\n      h(ClientOnly, () =>\n        h(\"div\", { class: \"tab-list\" }, [\n          h(\n            \"div\",\n            { class: \"tab-list-nav\", role: \"tablist\" },\n            props.data.map(({ title }, index) => {\n              const isActive = index === activeIndex.value;\n\n              return h(\n                \"button\",\n                {\n                  ref: (element) => {\n                    if (element)\n                      tabRefs.value[index] = <HTMLUListElement>element;\n                  },\n                  class: [\"tab-list-nav-item\", { active: isActive }],\n                  role: \"tab\",\n                  \"aria-controls\": `tab-${props.id}-${index}`,\n                  \"aria-selected\": isActive,\n                  onClick: () => {\n                    activeIndex.value = index;\n                    updateStore();\n                  },\n                  onKeydown: (event: KeyboardEvent) =>\n                    keyboardHandler(event, index),\n                },\n                title\n              );\n            })\n          ),\n          props.data.map(({ title, value = title }, index) => {\n            const isActive = index === activeIndex.value;\n\n            return h(\n              \"div\",\n              {\n                class: [\"tab-item\", { active: isActive }],\n                id: `tab-${props.id}-${index}`,\n                role: \"tabpanel\",\n                \"aria-expanded\": isActive,\n              },\n              slots[`tab${index}`]?.({ title, value, isActive })\n            );\n          }),\n        ])\n      );\n  },\n});\n"],"names":["tabStore","useStorage","Tabs","defineComponent","props","slots","activeIndex","ref","valueIndex","title","value","tabRefs","updateStore","activateNext","index","activatePrev","keyboardHandler","event","watch","newValue","oldValue","h","ClientOnly","isActive","element","_a"],"mappings":"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"}