{"version":3,"file":"PDF.js","sources":["../../../src/client/composables/size.ts","../../../src/client/components/PDF.ts"],"sourcesContent":["import { useEventListener } from \"@vueuse/core\";\nimport { computed, onMounted, isRef, ref, unref, watch } from \"vue\";\nimport type { MaybeRef } from \"@vueuse/core\";\nimport type { Ref } from \"vue\";\n\nconst getValue = (value: string | number): string =>\n  typeof value === \"string\" ? value : `${value}px`;\n\nexport interface SizeOptions {\n  width: string | number | undefined;\n  height: string | number | undefined;\n  ratio: number | undefined;\n}\n\nexport interface SizeInfo<E extends HTMLElement> {\n  el: Ref<E | undefined>;\n  width: Ref<string>;\n  height: Ref<string>;\n}\n\nexport const useSize = <E extends HTMLElement>(\n  options: SizeOptions,\n  extraHeight: MaybeRef<number> = 0\n): SizeInfo<E> => {\n  const el = ref<E>();\n  const width = computed(() => getValue(unref(options.width) || \"100%\"));\n  const height = ref(\"auto\");\n\n  const getHeight = (width: number): string => {\n    const height = unref(options.height);\n    const ratio = unref(options.ratio) || 16 / 9;\n\n    return height\n      ? getValue(height)\n      : `${Number(width) / ratio + unref(extraHeight)}px`;\n  };\n\n  const updateHeight = (): void => {\n    height.value = getHeight(el.value!.clientWidth);\n  };\n\n  onMounted(() => {\n    updateHeight();\n    if (isRef(extraHeight)) watch(extraHeight, () => updateHeight());\n    useEventListener(\"orientationchange\", () => updateHeight());\n    useEventListener(\"resize\", () => updateHeight());\n  });\n\n  return {\n    el,\n    width,\n    height,\n  };\n};\n","/* eslint-disable vue/no-unused-properties */\nimport { withBase } from \"@vuepress/client\";\nimport { isLinkHttp } from \"@vuepress/shared\";\nimport { computed, defineComponent, h, onMounted, ref } from \"vue\";\nimport {\n  checkIsMobile,\n  checkIsiPad,\n  checkIsiPhone,\n  checkIsSafari,\n} from \"vuepress-shared/client\";\nimport { useSize } from \"../composables/index.js\";\n\nimport type { VNode } from \"vue\";\n\nimport \"../styles/pdf.scss\";\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\ndeclare const __VUEPRESS_SSR__: boolean;\n\nexport default defineComponent({\n  name: \"PDF\",\n\n  props: {\n    /**\n     * PDF link, should be absolute url\n     *\n     * PDF 文件链接，应为完整链接\n     */\n    url: { type: String, required: true },\n\n    /**\n     * Component width\n     *\n     * 组件宽度\n     */\n    width: {\n      type: [String, Number],\n      default: \"100%\",\n    },\n\n    /**\n     * Component height\n     *\n     * 组件高度\n     */\n    height: {\n      type: [String, Number],\n      default: undefined,\n    },\n\n    /**\n     * Component width / height ratio\n     *\n     * 组件长宽比\n     */\n    ratio: {\n      type: Number,\n      default: 16 / 9,\n    },\n\n    /**\n     * PDF initial page number\n     *\n     * PDF 初始页码\n     *\n     * @description Chrome only\n     */\n    page: {\n      type: Number,\n      default: 1,\n    },\n\n    /**\n     * Whether show toolbar\n     *\n     * 是否显示工具栏\n     *\n     * @description Chrome only\n     */\n    noToolbar: Boolean,\n\n    /**\n     * initial zoom level (in percent)\n     *\n     * 初始缩放比率 (百分比)\n     */\n    zoom: {\n      type: Number,\n      default: 100,\n    },\n  },\n\n  setup(props) {\n    const { el, width, height } = useSize<HTMLDivElement>(props);\n    const isChrome = ref(true);\n    const isMobile = ref(false);\n\n    const hash = computed(\n      () =>\n        `#page=${props.page}&toolbar=${props.noToolbar ? 0 : 1}&zoom=${\n          props.zoom\n        }`\n    );\n\n    onMounted(() => {\n      const { userAgent } = navigator;\n\n      // chrome mobile\n      if (checkIsMobile(userAgent)) isMobile.value = true;\n      else if (\n        checkIsSafari(userAgent) &&\n        (checkIsiPad(userAgent) || checkIsiPhone(userAgent))\n      ) {\n        isChrome.value = false;\n\n        if (checkIsiPad(userAgent) || checkIsiPhone(userAgent))\n          isMobile.value = true;\n      }\n    });\n\n    return (): VNode => {\n      const fullLink = isLinkHttp(props.url)\n        ? props.url\n        : __VUEPRESS_SSR__\n        ? \"\"\n        : `${window?.location.origin || \"\"}${withBase(props.url)}`;\n\n      return h(\n        \"div\",\n        {\n          class: \"pdf-preview\",\n          ref: el,\n          style: {\n            width: width.value,\n            height: height.value,\n          },\n        },\n        [\n          h(\"iframe\", {\n            class: \"pdf-iframe\",\n            src: isMobile.value\n              ? `https://drive.google.com/viewerng/viewer?embedded=true&url=${encodeURI(\n                  fullLink\n                )}`\n              : `${withBase(props.url)}${isChrome.value ? hash.value : \"\"}`,\n          }),\n          h(\n            \"button\",\n            {\n              class: \"pdf-open-button\",\n              onClick: () => {\n                window.open(fullLink);\n              },\n            },\n            \"Open\"\n          ),\n        ]\n      );\n    };\n  },\n});\n"],"names":["getValue","value","useSize","options","extraHeight","el","ref","width","computed","unref","height","getHeight","ratio","updateHeight","onMounted","isRef","watch","useEventListener","defineComponent","props","isChrome","isMobile","hash","userAgent","checkIsMobile","checkIsSafari","checkIsiPad","checkIsiPhone","fullLink","isLinkHttp","withBase","h"],"mappings":"uYAKA,MAAMA,EAAYC,GAChB,OAAOA,GAAU,SAAWA,EAAQ,GAAGA,MAc5BC,EAAU,CACrBC,EACAC,EAAgC,IAChB,CAChB,MAAMC,EAAKC,IACLC,EAAQC,EAAS,IAAMR,EAASS,EAAMN,EAAQ,KAAK,GAAK,MAAM,CAAC,EAC/DO,EAASJ,EAAI,MAAM,EAEnBK,EAAaJ,GAA0B,CAC3C,MAAMG,EAASD,EAAMN,EAAQ,MAAM,EAC7BS,EAAQH,EAAMN,EAAQ,KAAK,GAAK,GAAK,EAE3C,OAAOO,EACHV,EAASU,CAAM,EACf,GAAG,OAAOH,CAAK,EAAIK,EAAQH,EAAML,CAAW,KAClD,EAEMS,EAAe,IAAY,CAC/BH,EAAO,MAAQC,EAAUN,EAAG,MAAO,WAAW,CAChD,EAEA,OAAAS,EAAU,IAAM,CACdD,IACIE,EAAMX,CAAW,GAAGY,EAAMZ,EAAa,IAAMS,EAAc,CAAA,EAC/DI,EAAiB,oBAAqB,IAAMJ,EAAc,CAAA,EAC1DI,EAAiB,SAAU,IAAMJ,EAAc,CAAA,CACjD,CAAC,EAEM,CACL,GAAAR,EACA,MAAAE,EACA,OAAAG,CACF,CACF,EClCA,IAAeQ,EAAAA,EAAgB,CAC7B,KAAM,MAEN,MAAO,CAML,IAAK,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOpC,MAAO,CACL,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAOA,OAAQ,CACN,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAOA,MAAO,CACL,KAAM,OACN,QAAS,GAAK,CAChB,EASA,KAAM,CACJ,KAAM,OACN,QAAS,CACX,EASA,UAAW,QAOX,KAAM,CACJ,KAAM,OACN,QAAS,GACX,CACF,EAEA,MAAMC,EAAO,CACX,KAAM,CAAE,GAAAd,EAAI,MAAAE,EAAO,OAAAG,CAAO,EAAIR,EAAwBiB,CAAK,EACrDC,EAAWd,EAAI,EAAI,EACnBe,EAAWf,EAAI,EAAK,EAEpBgB,EAAOd,EACX,IACE,SAASW,EAAM,gBAAgBA,EAAM,UAAY,EAAI,UACnDA,EAAM,MAEZ,EAEA,OAAAL,EAAU,IAAM,CACd,KAAM,CAAE,UAAAS,CAAU,EAAI,UAGlBC,EAAcD,CAAS,EAAGF,EAAS,MAAQ,GAE7CI,EAAcF,CAAS,IACtBG,EAAYH,CAAS,GAAKI,EAAcJ,CAAS,KAElDH,EAAS,MAAQ,IAEbM,EAAYH,CAAS,GAAKI,EAAcJ,CAAS,KACnDF,EAAS,MAAQ,IAEvB,CAAC,EAEM,IAAa,CAClB,MAAMO,EAAWC,EAAWV,EAAM,GAAG,EACjCA,EAAM,IACN,iBACA,GACA,IAAG,QAAQ,KAAA,OAAA,OAAA,SAAS,SAAU,KAAKW,EAASX,EAAM,GAAG,IAEzD,OAAOY,EACL,MACA,CACE,MAAO,cACP,IAAK1B,EACL,MAAO,CACL,MAAOE,EAAM,MACb,OAAQG,EAAO,KACjB,CACF,EACA,CACEqB,EAAE,SAAU,CACV,MAAO,aACP,IAAKV,EAAS,MACV,8DAA8D,UAC5DO,CACF,IACA,GAAGE,EAASX,EAAM,GAAG,IAAIC,EAAS,MAAQE,EAAK,MAAQ,IAC7D,CAAC,EACDS,EACE,SACA,CACE,MAAO,kBACP,QAAS,IAAM,CACb,OAAO,KAAKH,CAAQ,CACtB,CACF,EACA,MACF,CACF,CACF,CACF,CACF,CACF,CAAC"}