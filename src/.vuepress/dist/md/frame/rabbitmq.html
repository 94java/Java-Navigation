<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>RabbitMQ | Java-Navigation</title><meta name="description" content="ä»è‡ªå­¦è§’åº¦å‡ºå‘ï¼Œè®°å½•è‡ªå­¦æ‰€å¾—ï¼Œå¹¶ä¸æ–­å®Œå–„ã€æ›´æ–°ã€‚åŒ…å«ï¼šJavaåŸºç¡€çŸ¥è¯†ä½“ç³»ã€webå¼€å‘ç”¨åˆ°çš„å‰ç«¯çŸ¥è¯†ä»¥åŠå¸¸ç”¨çš„å„ç§æ¡†æ¶å’Œä¸­é—´ä»¶ï¼Œæ¶µç›–è®¡ç®—æœºåŸºç¡€ã€æ•°æ®åº“ã€éƒ¨ç½²å·¥å…·ä»¥åŠä»£ç é£æ ¼å’Œè§„èŒƒçš„å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼ˆå«é¢è¯•å’Œå®æˆ˜é¡¹ç›®æ¨èï¼‰">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style.20c1a94f.css" as="style" /><link rel="stylesheet" href="/assets/style.20c1a94f.css" />
    <link rel="modulepreload" href="/assets/app.69e51fc3.js"><link rel="modulepreload" href="/assets/rabbitmq.html.39bae457.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/rabbitmq.html.33738198.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Java-Navigation"><!----><span class="site-name hide-in-pad">Java-Navigation</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/md/quick_nav.html" class="nav-link" aria-label="å¯¼èˆª"><span class="icon iconfont icon-discover"></span>å¯¼èˆª<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title"><span class="icon iconfont icon-java"></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/md/java/basic.html" class="nav-link" aria-label="åŸºç¡€"><!---->åŸºç¡€<!----></a></li><li class="dropdown-item"><a href="/md/java/collection.html" class="nav-link" aria-label="å®¹å™¨"><!---->å®¹å™¨<!----></a></li><li class="dropdown-item"><a href="/md/java/concurrency.html" class="nav-link" aria-label="å¹¶å‘"><!---->å¹¶å‘<!----></a></li><li class="dropdown-item"><a href="/md/java/io.html" class="nav-link" aria-label="IO"><!---->IO<!----></a></li><li class="dropdown-item"><a href="/md/java/jvm.html" class="nav-link" aria-label="JVM"><!---->JVM<!----></a></li><li class="dropdown-item"><a href="/md/java/new.html" class="nav-link" aria-label="æ–°ç‰¹æ€§"><!---->æ–°ç‰¹æ€§<!----></a></li><li class="dropdown-item"><a href="/md/java/javaweb.html" class="nav-link" aria-label="JavaWEB"><!---->JavaWEB<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è®¡ç®—æœºåŸºç¡€"><span class="title"><span class="icon iconfont icon-study"></span>è®¡ç®—æœºåŸºç¡€</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/common//network" class="nav-link" aria-label="è®¡ç®—æœºç½‘ç»œ"><!---->è®¡ç®—æœºç½‘ç»œ<!----></a></li><li class="dropdown-item"><a href="/common//composition" class="nav-link" aria-label="è®¡ç®—æœºç»„æˆåŸç†"><!---->è®¡ç®—æœºç»„æˆåŸç†<!----></a></li><li class="dropdown-item"><a href="/common//os" class="nav-link" aria-label="æ“ä½œç³»ç»Ÿ"><!---->æ“ä½œç³»ç»Ÿ<!----></a></li><li class="dropdown-item"><a href="/common//structure" class="nav-link" aria-label="æ•°æ®ç»“æ„"><!---->æ•°æ®ç»“æ„<!----></a></li><li class="dropdown-item"><a href="/common//algorithm" class="nav-link" aria-label="ç®—æ³•"><!---->ç®—æ³•<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring"><span class="title"><span class="icon iconfont icon-emmet"></span>Spring</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/md/spring/framework.html" class="nav-link" aria-label="Framework"><!---->Framework<!----></a></li><li class="dropdown-item"><a href="/md/spring/mvc.html" class="nav-link" aria-label="MVC"><!---->MVC<!----></a></li><li class="dropdown-item"><a href="/md/spring/boot.html" class="nav-link" aria-label="Boot"><!---->Boot<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title"><span class="icon iconfont icon-mysql"></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>åŸºç¡€çŸ¥è¯†</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/database/base.html" class="nav-link" aria-label="æ•°æ®åº“åŸç†"><!---->æ•°æ®åº“åŸç†<!----></a></li><li class="dropdown-subitem"><a href="/md/database/sql.html" class="nav-link" aria-label="SQLè¯­æ³•"><!---->SQLè¯­æ³•<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>SQLæ•°æ®åº“</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/database/mysql.html" class="nav-link" aria-label="MySQL"><!---->MySQL<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>NoSQLæ•°æ®åº“</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/database/redis.html" class="nav-link" aria-label="Redis"><!---->Redis<!----></a></li><li class="dropdown-subitem"><a href="/md/database/mongodb.html" class="nav-link" aria-label="MongoDB"><!---->MongoDB<!----></a></li><li class="dropdown-subitem"><a href="/md/database/elasticsearch.html" class="nav-link" aria-label="ElasticSearch"><!---->ElasticSearch<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ¡†æ¶|ä¸­é—´ä»¶"><span class="title"><span class="icon iconfont icon-repair"></span>æ¡†æ¶|ä¸­é—´ä»¶</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å¸¸ç”¨æ¡†æ¶</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/frame/mybatis.html" class="nav-link" aria-label="MyBatis"><!---->MyBatis<!----></a></li><li class="dropdown-subitem"><a href="/md/frame/mybatis_plus.html" class="nav-link" aria-label="MyBatis-Plus"><!---->MyBatis-Plus<!----></a></li><li class="dropdown-subitem"><a href="/md/frame/dubbo.html" class="nav-link" aria-label="Dubbo"><!---->Dubbo<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ä¸­é—´ä»¶</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/frame/zookeeper.html" class="nav-link" aria-label="Zookeeper"><!---->Zookeeper<!----></a></li><li class="dropdown-subitem"><a aria-current="page" href="/md/frame/rabbitmq.html" class="router-link-active router-link-exact-active nav-link active" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å·¥å…·|éƒ¨ç½²"><span class="title"><span class="icon iconfont icon-relation"></span>å·¥å…·|éƒ¨ç½²</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>éƒ¨ç½²</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/tool/linux.html" class="nav-link" aria-label="Linux"><!---->Linux<!----></a></li><li class="dropdown-subitem"><a href="/md/tool/docker.html" class="nav-link" aria-label="Docker"><!---->Docker<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å·¥å…·</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/tool/maven.html" class="nav-link" aria-label="Maven"><!---->Maven<!----></a></li><li class="dropdown-subitem"><a href="/md/tool/git.html" class="nav-link" aria-label="Git"><!---->Git<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Web å®¹å™¨</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/tool/tomcat.html" class="nav-link" aria-label="Tomcat"><!---->Tomcat<!----></a></li><li class="dropdown-subitem"><a href="/md/tool/nginx.html" class="nav-link" aria-label="Nginx"><!---->Nginx<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å‰ç«¯"><span class="title"><span class="icon iconfont icon-leaf"></span>å‰ç«¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/guide//" class="nav-link" aria-label="..."><!---->...<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ¶æ„"><span class="title"><span class="icon iconfont icon-material"></span>æ¶æ„</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/guide//" class="nav-link" aria-label="..."><!---->...<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="é£æ ¼|è§„èŒƒ"><span class="title"><span class="icon iconfont icon-note"></span>é£æ ¼|è§„èŒƒ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/guide//" class="nav-link" aria-label="..."><!---->...<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/zh/guide/README.md" class="nav-link" aria-label="é¢è¯•"><span class="icon iconfont icon-editor"></span>é¢è¯•<!----></a></div><div class="nav-item hide-in-mobile"><a href="/zh/guide/README.md" class="nav-link" aria-label="é¡¹ç›®"><span class="icon iconfont icon-creative"></span>é¡¹ç›®<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/HelloCode66/Java-Navigation" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><div class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></div><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-guide"></span><span class="title">æ¡†æ¶ | ä¸­é—´ä»¶</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/md/frame/outline.html" class="nav-link sidebar-link sidebar-page" aria-label="å¤§çº²"><!---->å¤§çº²<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/md/frame/mybatis.html" class="nav-link sidebar-link sidebar-page" aria-label="MyBatis"><!---->MyBatis<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/md/frame/mybatis_plus.html" class="nav-link sidebar-link sidebar-page" aria-label="MyBatis-Plus"><!---->MyBatis-Plus<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/md/frame/dubbo.html" class="nav-link sidebar-link sidebar-page" aria-label="Dubbo"><!---->Dubbo<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/md/frame/zookeeper.html" class="nav-link sidebar-link sidebar-page" aria-label="Zookeeper"><!---->Zookeeper<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/md/frame/rabbitmq.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/md/frame/rabbitmq.html#åŸºæœ¬æ¦‚å¿µ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åŸºæœ¬æ¦‚å¿µ"><!---->åŸºæœ¬æ¦‚å¿µ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/md/frame/rabbitmq.html#å¿«é€Ÿå…¥é—¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¿«é€Ÿå…¥é—¨"><!---->å¿«é€Ÿå…¥é—¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/md/frame/rabbitmq.html#å·¥ä½œæ¨¡å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å·¥ä½œæ¨¡å¼"><!---->å·¥ä½œæ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/md/frame/rabbitmq.html#springæ•´åˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Springæ•´åˆ"><!---->Springæ•´åˆ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/md/frame/rabbitmq.html#é«˜çº§ç‰¹æ€§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é«˜çº§ç‰¹æ€§"><!---->é«˜çº§ç‰¹æ€§<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/md/frame/rabbitmq.html#åº”ç”¨é—®é¢˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åº”ç”¨é—®é¢˜"><!---->åº”ç”¨é—®é¢˜<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/md/frame/rabbitmq.html#é›†ç¾¤æ­å»º" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é›†ç¾¤æ­å»º"><!---->é›†ç¾¤æ­å»º<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/md/frame/interview.html" class="nav-link sidebar-link sidebar-page" aria-label="é¢è¯•å®å…¸"><!---->é¢è¯•å®å…¸<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/md/frame/resource.html" class="nav-link sidebar-link sidebar-page" aria-label="å­¦ä¹ èµ„æ–™"><!---->å­¦ä¹ èµ„æ–™<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->RabbitMQ</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://java-navigation.gitee.io/" target="_blank" rel="noopener noreferrer">HelloCode.</a></span><span property="author" content="HelloCode."></span></span><!----><!----><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li><span class="category category7" role>æ¡†æ¶ | ä¸­é—´ä»¶</span></li></ul><meta property="articleSection" content="æ¡†æ¶ | ä¸­é—´ä»¶"></span><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 37 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT37M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/md/frame/rabbitmq.html#åŸºæœ¬æ¦‚å¿µ" class="router-link-active router-link-exact-active toc-link level3">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/md/frame/rabbitmq.html#å¿«é€Ÿå…¥é—¨" class="router-link-active router-link-exact-active toc-link level3">å¿«é€Ÿå…¥é—¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/md/frame/rabbitmq.html#å·¥ä½œæ¨¡å¼" class="router-link-active router-link-exact-active toc-link level3">å·¥ä½œæ¨¡å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/md/frame/rabbitmq.html#springæ•´åˆ" class="router-link-active router-link-exact-active toc-link level3">Springæ•´åˆ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/md/frame/rabbitmq.html#é«˜çº§ç‰¹æ€§" class="router-link-active router-link-exact-active toc-link level3">é«˜çº§ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/md/frame/rabbitmq.html#åº”ç”¨é—®é¢˜" class="router-link-active router-link-exact-active toc-link level3">åº”ç”¨é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/md/frame/rabbitmq.html#é›†ç¾¤æ­å»º" class="router-link-active router-link-exact-active toc-link level3">é›†ç¾¤æ­å»º</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="rabbitmq" tabindex="-1"><a class="header-anchor" href="#rabbitmq" aria-hidden="true">#</a> RabbitMQ</h1><h3 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ" aria-hidden="true">#</a> åŸºæœ¬æ¦‚å¿µ</h3><p><strong>MQæ¦‚è¿°</strong></p><ul><li>MQå…¨ç§° <em>M</em>essage <em>Q</em>ueueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œæ˜¯åœ¨æ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ä¸­ä¿å­˜æ¶ˆæ¯çš„å®¹å™¨ã€‚å¤šç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´è¿›è¡Œé€šä¿¡</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿé€šä¿¡æœ‰ä¸¤ç§æ–¹å¼ï¼šç›´æ¥è¿œç¨‹è°ƒç”¨ å’Œ å€ŸåŠ©ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ å®Œæˆé—´æ¥é€šä¿¡</li><li>å‘é€æ–¹ç§°ä¸ºç”Ÿäº§è€…ï¼Œæ¥æ”¶æ–¹ç§°ä¸ºæ¶ˆè´¹è€…</li></ul><p><em>ä¼˜åŠ¿</em></p><ul><li><p>åº”ç”¨è§£è€¦ <img src="http://images.hellocode.top/9545b9dc37974c71ab2ac9b39c079518.png" alt="img" loading="lazy"></p><p>ç³»ç»Ÿçš„è€¦åˆæ€§è¶Šé«˜ï¼Œå®¹é”™æ€§å°±è¶Šä½ï¼Œå¯ç»´æŠ¤æ€§å°±è¶Šä½</p></li><li><p>å¼‚æ­¥æé€Ÿ</p><p><img src="http://images.hellocode.top/61ba95a12af14cb48f1b60291987f3d1.png" alt="img" loading="lazy"> æå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿååé‡ï¼ˆå•ä½æ—¶é—´å†…å¤„ç†è¯·æ±‚çš„æ•°ç›®ï¼‰</p></li><li><p>å‰Šå³°å¡«è°·</p><p><img src="http://images.hellocode.top/1ce007439c8a405b8e46f8ae1da312f5.png" alt="img" loading="lazy"> ä½¿ç”¨äº†MQä¹‹åï¼Œå‡è®¾æœåŠ¡å™¨æ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦ä¸º1000ï¼Œè¿™æ ·ä¸€æ¥ï¼Œé«˜å³°æœŸäº§ç”Ÿçš„æ•°æ®åŠ¿å¿…ä¼šè¢«ç§¯å‹åœ¨MQä¸­ï¼Œé«˜å³°å°±è¢«â€œå‰Šâ€æ‰äº†ï¼Œä½†æ˜¯å› ä¸ºæ¶ˆæ¯ç§¯å‹ï¼Œåœ¨é«˜å³°æœŸè¿‡åçš„ä¸€æ®µæ—¶é—´å†…ï¼Œæ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦è¿˜æ˜¯ä¼šç»´æŒåœ¨1000ï¼Œç›´åˆ°æ¶ˆè´¹å®Œç§¯å‹æ‰çš„æ¶ˆæ¯ï¼Œè¿™å°±å«â€œå¡«è°·â€</p></li></ul><p><em>åŠ£åŠ¿</em></p><ul><li>ç³»ç»Ÿå¯ç”¨æ€§é™ä½ ç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œç³»ç»Ÿç¨³å®šæ€§è¶Šå·®ã€‚ä¸€æ—¦MQå®•æœºï¼Œå°±ä¼šå¯¹ä¸šåŠ¡é€ æˆå½±å“ã€‚å°±éœ€è¦ä¿è¯MQçš„é«˜å¯ç”¨</li><li>ç³»ç»Ÿå¤æ‚åº¦æé«˜ MQçš„åŠ å…¥å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œä»¥å‰ç³»ç»Ÿé—´æ˜¯åŒæ­¥çš„è¿œç¨‹è°ƒç”¨ï¼Œç°åœ¨é€šè¿‡MQè¿›è¡Œå¼‚æ­¥è°ƒç”¨ã€‚éœ€è¦è€ƒè™‘æ¶ˆæ¯æ˜¯å¦è¢«é‡å¤æ¶ˆè´¹ï¼Œå¦‚ä½•å¤„ç†ä¸¢å¤±çš„æ¶ˆæ¯ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§</li><li>ä¸€è‡´æ€§é—®é¢˜ Aç³»ç»Ÿå¤„ç†å®Œä¸šåŠ¡ï¼Œé€šè¿‡MQç»™Bã€Cã€Dä¸‰ä¸ªç³»ç»Ÿå‘æ¶ˆæ¯æ•°æ®ï¼Œå¦‚æœBç³»ç»Ÿã€Cç³»ç»Ÿå¤„ç†æˆåŠŸï¼ŒDç³»ç»Ÿå¤„ç†å¤±è´¥ã€‚å¦‚ä½•ä¿è¯æ¶ˆæ¯æ•°æ®å¤„ç†çš„ä¸€è‡´æ€§</li></ul><p><strong>ä½¿ç”¨MQéœ€è¦æ»¡è¶³çš„æ¡ä»¶</strong></p><ol><li>ç”Ÿäº§è€…ä¸éœ€è¦ä»æ¶ˆè´¹è€…å¤„è·å¾—åé¦ˆã€‚å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å‰çš„ç›´æ¥è°ƒç”¨ï¼Œå…¶æ¥å£çš„è¿”å›å€¼åº”è¯¥ä¸ºç©ºï¼Œè¿™æ‰è®©æ˜æ˜ä¸‹å±‚çš„åŠ¨ä½œè¿˜æ²¡åšï¼Œä¸Šå±‚å´å½“æˆåŠ¨ä½œåšå®Œäº†ç»§ç»­å¾€åèµ°ï¼Œå³æ‰€è°“å¼‚æ­¥æˆä¸ºäº†å¯èƒ½</li><li>å®¹è®¸çŸ­æš‚çš„ä¸ä¸€è‡´æ€§</li><li>ç¡®å®æ˜¯ç”¨äº†æœ‰æ•ˆæœã€‚å³è§£è€¦ã€æé€Ÿã€å‰Šå³°è¿™äº›æ–¹é¢çš„æ”¶ç›Šï¼Œè¶…è¿‡åŠ å…¥MQï¼Œç®¡ç†MQè¿™äº›æˆæœ¬</li></ol><p><strong>å¸¸è§çš„MQäº§å“</strong></p><p>ç›®å‰ä¸šç•Œæœ‰å¾ˆå¤šçš„MQäº§å“ï¼Œä¾‹å¦‚ RabbitMQã€RocketMQã€ActiveMQã€Kafkaã€ZeroMQã€MetaMqç­‰ï¼Œä¹Ÿæœ‰ç›´æ¥ä½¿ç”¨Rediså……å½“æ¶ˆæ¯é˜Ÿåˆ—çš„æ¡ˆä¾‹ï¼Œè€Œè¿™äº›æ¶ˆæ¯é˜Ÿåˆ—äº§å“ï¼Œå„æœ‰ä¾§é‡ï¼Œåœ¨å®é™…é€‰å‹æ—¶ï¼Œéœ€è¦ç»“åˆè‡ªèº«éœ€æ±‚åŠMQäº§å“ç‰¹å¾ï¼Œç»¼åˆè€ƒè™‘</p><p><img src="http://images.hellocode.top/2140587-20201016115946384-1900840176.png" alt="img" loading="lazy"></p><h3 id="å¿«é€Ÿå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#å¿«é€Ÿå…¥é—¨" aria-hidden="true">#</a> å¿«é€Ÿå…¥é—¨</h3><h4 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°" aria-hidden="true">#</a> æ¦‚è¿°</h4><p><strong>AMQP</strong>ï¼Œå³<em>Advanced Message Queuing Protocol</em>ï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰ï¼Œæ˜¯ä¸€ä¸ªç½‘ç»œåè®®ï¼Œæ˜¯åº”ç”¨å±‚åè®®çš„ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œä¸ºé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶è®¾è®¡ã€‚åŸºäºæ­¤åè®®çš„å®¢æˆ·ç«¯ä¸æ¶ˆæ¯ä¸­é—´ä»¶å¯ä¼ é€’æ¶ˆæ¯ï¼Œå¹¶ä¸å—å®¢æˆ·ç«¯/ä¸­é—´ä»¶ä¸åŒäº§å“ï¼Œä¸åŒå¼€å‘è¯­è¨€ç­‰æ¡ä»¶çš„é™åˆ¶ã€‚2006å¹´ï¼ŒAMQPè§„èŒƒå‘å¸ƒã€‚<em>ç±»åˆ«HTTP</em></p><p><img src="http://images.hellocode.top/u=1059749409,303090146&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=PNG" alt="img" loading="lazy"></p><p>2007å¹´ï¼ŒRabbitæŠ€æœ¯å…¬å¸åŸºäºAMQPæ ‡å‡†å¼€å‘çš„RabbitMQ1.0å‘å¸ƒã€‚RabbitMQé‡‡ç”¨Erlangè¯­è¨€å¼€å‘ã€‚Erlangè¯­è¨€ç”±Ericsonè®¾è®¡ï¼Œä¸“é—¨ä¸ºå¼€å‘é«˜å¹¶å‘å’Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ç§è¯­è¨€ï¼Œåœ¨ç”µä¿¡é¢†åŸŸä½¿ç”¨å¹¿æ³›</p><p>RabbitMQåŸºç¡€æ¶æ„å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://images.hellocode.top/90ae75ef1d82478ca14539ddf960f210.png" alt="img" loading="lazy"></p><p><strong>RabbitMQä¸­çš„ç›¸å…³æ¦‚å¿µ</strong></p><p><em>Broker</em>ï¼šæ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Serverå°±æ˜¯ Message Broker</p><p><em>Virtual host</em>ï¼šå‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠ AMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºç½‘ç»œä¸­çš„ namespace æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ª RabbitMQ server æä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªvhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ vhost åˆ›å»º exchangeï¼queue ç­‰</p><p><em>Connection</em>ï¼špublisherï¼consumer å’Œ broker ä¹‹é—´çš„ TCP è¿æ¥</p><p><em>Channel</em>ï¼šå¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ª Connectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹ TCP Connectionçš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channel æ˜¯åœ¨ connection å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ç¨‹ï¼Œé€šå¸¸æ¯ä¸ªthreadåˆ›å»ºå•ç‹¬çš„ channel è¿›è¡Œé€šè®¯ï¼ŒAMQP method åŒ…å«äº†channel id å¸®åŠ©å®¢æˆ·ç«¯å’Œmessage broker è¯†åˆ« channelï¼Œæ‰€ä»¥ channel ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channel ä½œä¸ºè½»é‡çº§çš„ Connection æå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹ TCP connection çš„å¼€é”€</p><p><em>Exchange</em>ï¼šmessage åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œåˆ†å‘æ¶ˆæ¯åˆ°queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šdirect (point-to-point), topic (publish-subscribe) and fanout (multicast)</p><p><em>Queue</em>ï¼šæ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾… consumer å–èµ°</p><p><em>Binding</em>ï¼šexchange å’Œ queue ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbinding ä¸­å¯ä»¥åŒ…å« routing keyã€‚Binding ä¿¡æ¯è¢«ä¿å­˜åˆ° exchange ä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äº message çš„åˆ†å‘ä¾æ®</p><p>**RabbitMQæä¾›äº†6ç§å·¥ä½œæ¨¡å¼ï¼š**ç®€å•æ¨¡å¼ã€work queuesã€Publish/Subscribeå‘å¸ƒä¸è®¢é˜…æ¨¡å¼ã€Routingè·¯ç”±æ¨¡å¼ã€Topicsä¸»é¢˜æ¨¡å¼ã€RPCè¿œç¨‹è°ƒç”¨æ¨¡å¼ï¼ˆè¿œç¨‹è°ƒç”¨ï¼Œä¸å¤ªç®—MQï¼Œæš‚ä¸ä»‹ç»ï¼‰</p><p>å®˜ç½‘å¯¹åº”æ¨¡å¼ä»‹ç»ï¼š<a href="https://www.rabbitmq.com/getstarted.html" target="_blank" rel="noopener noreferrer">https://www.rabbitmq.com/getstarted.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="http://images.hellocode.top/20200906215140115.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><p><strong>JMS</strong></p><ul><li>JMSå³Javaæ¶ˆæ¯æœåŠ¡ï¼ˆJavaMessage Serviceï¼‰åº”ç”¨ç¨‹åºæ¥å£ï¼Œæ˜¯ä¸€ä¸ªJavaå¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„API</li><li>JMSæ˜¯JavaEEè§„èŒƒä¸­çš„ä¸€ç§ï¼Œç±»æ¯”JDBC</li><li>å¾ˆå¤šçš„æ¶ˆæ¯ä¸­é—´ä»¶éƒ½å®ç°äº†JMSè§„èŒƒï¼Œä¾‹å¦‚ï¼šActiveMQã€‚RabbitMQå®˜æ–¹æ²¡æœ‰æä¾›JMSçš„å®ç°åŒ…ï¼Œä½†æ˜¯å¼€æºç¤¾åŒºæœ‰</li></ul><h4 id="å®‰è£…ä¸é…ç½®" tabindex="-1"><a class="header-anchor" href="#å®‰è£…ä¸é…ç½®" aria-hidden="true">#</a> å®‰è£…ä¸é…ç½®</h4><ul><li>RabbitMQå®˜æ–¹åœ°å€ï¼š<a href="http://www.rabbitmq.com" target="_blank" rel="noopener noreferrer">http://www.rabbitmq.com<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p><strong>æ­¥éª¤</strong></p><ol><li><em>å®‰è£…ä¾èµ–ç¯å¢ƒï¼ˆåœ¨çº¿å®‰è£…ä¾èµ–ç¯å¢ƒï¼‰</em></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> build-essential openssl openssl-devel unixODBC unixODBC-devel <span class="token function">make</span> gcc gcc-c++ kernel-devel m4 ncurses-devel tk tc xz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li><p><em>å®‰è£…Erlang</em> ä¸Šä¼ </p><p>erlang-18.3-1.el7.centos.x86_64.rpm socat-1.7.3.2-5.el7.lux.x86_64.rpm rabbitmq-server-3.6.5-1.noarch.rpm</p></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å®‰è£…</span>
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> erlang-18.3-1.el7.centos.x86_64.rpm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><em>å®‰è£…RabbitMQ</em>ï¼ˆé»˜è®¤å®‰è£…è·¯å¾„<code>/usr/share/doc/rabbitmq-server-3.6.5/</code>ï¼‰</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å®‰è£…</span>
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> socat-1.7.3.2-5.el7.lux.x86_64.rpm

<span class="token comment"># å®‰è£…</span>
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> rabbitmq-server-3.6.5-1.noarch.rpm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li><em>å¼€å¯ç®¡ç†ç•Œé¢åŠé…ç½®</em></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å¼€å¯ç®¡ç†ç•Œé¢</span>
rabbitmq-plugins <span class="token builtin class-name">enable</span> rabbitmq_management
 
<span class="token comment"># è®¾ç½®ç”¨æˆ·åå¯†ç </span>
rabbitmqctl add_user ç”¨æˆ·å å¯†ç 
<span class="token comment"># è®¾ç½®æƒé™</span>
rabbitmqctl  set_user_tags  ç”¨æˆ·å administrator
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em>è§’è‰²è¯´æ˜</em>ï¼š</p><p>1ã€ è¶…çº§ç®¡ç†å‘˜(administrator)</p><p>å¯ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥å¯¹ç”¨æˆ·ï¼Œç­–ç•¥(policy)è¿›è¡Œæ“ä½œã€‚</p><p>2ã€ ç›‘æ§è€…(monitoring)</p><p>å¯ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼ŒåŒæ—¶å¯ä»¥æŸ¥çœ‹rabbitmqèŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯(è¿›ç¨‹æ•°ï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œç£ç›˜ä½¿ç”¨æƒ…å†µç­‰)</p><p>3ã€ ç­–ç•¥åˆ¶å®šè€…(policymaker)</p><p>å¯ç™»é™†ç®¡ç†æ§åˆ¶å°, åŒæ—¶å¯ä»¥å¯¹policyè¿›è¡Œç®¡ç†ã€‚ä½†æ— æ³•æŸ¥çœ‹èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯(ä¸Šå›¾çº¢æ¡†æ ‡è¯†çš„éƒ¨åˆ†)ã€‚</p><p>4ã€ æ™®é€šç®¡ç†è€…(management)</p><p>ä»…å¯ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼Œæ— æ³•çœ‹åˆ°èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•å¯¹ç­–ç•¥è¿›è¡Œç®¡ç†ã€‚</p><p>5ã€ å…¶ä»–</p><p>æ— æ³•ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼Œé€šå¸¸å°±æ˜¯æ™®é€šçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚</p><ol start="5"><li><em>å¯åŠ¨</em></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">service</span> rabbitmq-server start <span class="token comment"># å¯åŠ¨æœåŠ¡</span>
<span class="token function">service</span> rabbitmq-server stop <span class="token comment"># åœæ­¢æœåŠ¡</span>
<span class="token function">service</span> rabbitmq-server restart <span class="token comment"># é‡å¯æœåŠ¡</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è®¾ç½®é…ç½®æ–‡ä»¶</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/share/doc/rabbitmq-server-3.6.5/
<span class="token function">cp</span> rabbitmq.config.example /etc/rabbitmq/rabbitmq.config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li><p><em>é…ç½®è™šæ‹Ÿä¸»æœºåŠç”¨æˆ·</em></p><ul><li>RabbitMQåœ¨å®‰è£…å¥½åï¼Œå¯ä»¥è®¿é—®<code>http://ipåœ°å€:15672</code> ï¼›ä½¿ç”¨è‡ªå®šä¹‰çš„ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•</li><li>è™šæ‹ŸæœºåŠç”¨æˆ·çš„æ·»åŠ é€šè¿‡å›¾å½¢åŒ–ç•Œé¢æ“ä½œå³å¯</li></ul></li></ol><h4 id="å…¥é—¨ç¨‹åº" tabindex="-1"><a class="header-anchor" href="#å…¥é—¨ç¨‹åº" aria-hidden="true">#</a> å…¥é—¨ç¨‹åº</h4><p>éœ€æ±‚ï¼šä½¿ç”¨ç®€å•æ¨¡å¼å®Œæˆæ¶ˆæ¯ä¼ é€’</p><p><img src="http://images.hellocode.top/image-20220908144201038.png" alt="image-20220908144201038" loading="lazy"></p><p><strong>æ­¥éª¤</strong></p><ol><li><p>åˆ›å»ºå·¥ç¨‹ï¼ˆç”Ÿäº§è€…producerã€æ¶ˆè´¹è€…consumerï¼‰</p></li><li><p>åˆ†åˆ«æ·»åŠ ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.rabbitmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>amqp-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç¼–å†™ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</p><ol><li>åˆ›å»ºè¿æ¥å·¥å‚</li><li>è®¾ç½®å‚æ•°ï¼ˆä¸»æœºã€ç«¯å£ã€è™šæ‹Ÿæœºã€ç”¨æˆ·åä»¥åŠå¯†ç ç­‰ç­‰ï¼‰</li><li>åˆ›å»ºè¿æ¥Connection</li><li>åˆ›å»ºchannel</li><li>åˆ›å»ºé˜Ÿåˆ—Queue <ul><li>queueï¼šé˜Ÿåˆ—åç§°ï¼ˆæ— åˆ™åˆ›å»ºï¼Œæœ‰å°±ä¸ä¼šåˆ›å»ºï¼‰</li><li>durableï¼šæ˜¯å¦æŒä¹…åŒ–ï¼Œå½“mqé‡å¯ä¹‹åï¼Œè¿˜åœ¨</li><li>exclusiveï¼š æ˜¯å¦ç‹¬å ï¼Œåªèƒ½ç”±ä¸€ä¸ªæ¶ˆè´¹è€…ç›‘å¬è¿™ä¸ªé˜Ÿåˆ— å½“Connectionå…³é—­æ—¶ï¼Œæ˜¯å¦åˆ é™¤é˜Ÿåˆ—</li><li>autoDeleteï¼šæ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚å½“æ²¡æœ‰Consumeræ—¶ï¼Œè‡ªåŠ¨åˆ é™¤æ‰</li><li>argumentsï¼šå‚æ•°ä¿¡æ¯</li></ul></li><li>å‘é€æ¶ˆæ¯ï¼ˆ<code>basicPublish()</code>ï¼‰ <ul><li>exchangeï¼šäº¤æ¢æœºåç§°ã€‚ç®€å•æ¨¡å¼ä¸‹äº¤æ¢æœºä¼šä½¿ç”¨é»˜è®¤çš„ç©ºå­—ç¬¦ä¸²&quot;&quot;</li><li>routingKeyï¼šè·¯ç”±åç§°ï¼Œä½¿ç”¨é»˜è®¤äº¤æ¢æœºæ—¶ï¼Œè·¯ç”±åç§°è¦å’Œé˜Ÿåˆ—åç§°ä¸€æ ·</li><li>propsï¼šé…ç½®ä¿¡æ¯</li><li>bodyï¼šè¦å‘é€çš„æ¶ˆæ¯æ•°æ®</li></ul></li><li>é‡Šæ”¾èµ„æºï¼ˆchannelå’Œconnectionï¼‰</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ08æ—¥ 15:10
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello_Producer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.23.129&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºchannel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—queue</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;hello_world&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å‘é€æ¶ˆæ¯</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token string">&quot;hello rabbitmq~~~&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello_world&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é‡Šæ”¾èµ„æº</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç¼–å†™æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯<code>channel.</code></p><ul><li>queueï¼šé˜Ÿåˆ—åç§°</li><li>autoAckï¼šæ˜¯å¦è‡ªåŠ¨ç¡®è®¤</li><li>callbackï¼šå›è°ƒå¯¹è±¡</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ08æ—¥ 17:39
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello_Consumer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.23.129&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºchannel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        
        <span class="token comment">// æ¥æ”¶æ¶ˆæ¯</span>
        <span class="token class-name">Consumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// å›è°ƒæ–¹æ³•ï¼Œæ”¶åˆ°æ¶ˆæ¯åè‡ªåŠ¨æ‰§è¡Œè¯¥æ–¹æ³•</span>
            <span class="token comment">/*
            * consumerTag:æ ‡è¯†
            * envelope:è·å–ä¸€äº›ä¿¡æ¯ï¼Œäº¤æ¢æœºã€è·¯ç”±keyã€‚ã€‚ã€‚ã€‚
            * propertiesï¼šé…ç½®ä¿¡æ¯
            * bodyï¼šæ•°æ®
            * */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;consumerTag&quot;</span><span class="token operator">+</span>consumerTag<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;getExchange&quot;</span><span class="token operator">+</span>envelope<span class="token punctuation">.</span><span class="token function">getExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;getRoutingKey&quot;</span><span class="token operator">+</span>envelope<span class="token punctuation">.</span><span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;properties&quot;</span><span class="token operator">+</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–æ¶ˆæ¯</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">&quot;hello_world&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¶ˆè´¹è€…ä¸éœ€è¦å…³é—­èµ„æºï¼Œéœ€è¦ä¸€ç›´ä¿æŒç›‘å¬çŠ¶æ€</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æµ‹è¯•</p></li></ol><h3 id="å·¥ä½œæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å·¥ä½œæ¨¡å¼" aria-hidden="true">#</a> å·¥ä½œæ¨¡å¼</h3><h4 id="work-queueså·¥ä½œé˜Ÿåˆ—æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#work-queueså·¥ä½œé˜Ÿåˆ—æ¨¡å¼" aria-hidden="true">#</a> Work queueså·¥ä½œé˜Ÿåˆ—æ¨¡å¼</h4><p><img src="http://images.hellocode.top/python-two.png" alt="img" loading="lazy"></p><ul><li>Work Queuesï¼šä¸å…¥é—¨ç¨‹åºçš„ç®€å•æ¨¡å¼ç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ªæˆ–ä¸€äº›æ¶ˆè´¹ç«¯ï¼Œå¤šä¸ªæ¶ˆè´¹ç«¯å…±åŒæ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼ˆç«äº‰å…³ç³»ï¼‰</li><li>åº”ç”¨åœºæ™¯ï¼šå¯¹äºä»»åŠ¡è¿‡é‡æˆ–ä»»åŠ¡è¾ƒå¤šæƒ…å†µä½¿ç”¨å·¥ä½œé˜Ÿåˆ—å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†çš„é€Ÿåº¦ï¼Œä¾‹å¦‚ï¼šçŸ­ä¿¡æœåŠ¡éƒ¨ç½²å¤šä¸ªï¼Œåªéœ€è¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æˆåŠŸå‘é€å³å¯</li><li>Work Queuesä¸å…¥é—¨ç¨‹åºçš„ç®€å•æ¨¡å¼çš„ä»£ç å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚å¯ä»¥å®Œå…¨å¤åˆ¶ï¼Œå¹¶å¤šå¤åˆ¶ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œå¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶å¯¹æ¶ˆè´¹æ¶ˆæ¯çš„æµ‹è¯•</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ08æ—¥ 15:10
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Work_queues</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.23.129&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºchannel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—queue</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;work_queues&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å‘é€æ¶ˆæ¯</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> body <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token string">&quot;hello rabbitmq~~~&quot;</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;work_queues&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// é‡Šæ”¾èµ„æº</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ08æ—¥ 17:39
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Work_queues1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.23.129&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºchannel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¥æ”¶æ¶ˆæ¯</span>
        <span class="token class-name">Consumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">&quot;work_queues&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¶ˆè´¹è€…ä¸éœ€è¦å…³é—­èµ„æºï¼Œéœ€è¦ä¸€ç›´ä¿æŒç›‘å¬çŠ¶æ€</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œ10æ¡æ¶ˆæ¯ã€‚æ¶ˆè´¹è€…1æ¶ˆè´¹1 3 5 7 9ï¼Œæ¶ˆè´¹è€…2æ¶ˆè´¹2 4 6 8 10</p></blockquote><h4 id="pub-subè®¢é˜…æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#pub-subè®¢é˜…æ¨¡å¼" aria-hidden="true">#</a> Pub/Subè®¢é˜…æ¨¡å¼</h4><p><img src="http://images.hellocode.top/python-three-overall.png" alt="img" loading="lazy"></p><p>åœ¨è®¢é˜…æ¨¡å¼ä¸­ï¼Œå¤šäº†ä¸€ä¸ªExchangeè§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š</p><ul><li>Pï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘é€ç»™Xï¼ˆäº¤æ¢æœºï¼‰</li><li>Cï¼šæ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯çš„æ¥æ”¶è€…ï¼Œä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥</li><li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯</li><li>Exchangeï¼šäº¤æ¢æœºï¼ˆXï¼‰ã€‚ä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚Exchangeæœ‰å¸¸è§ä»¥ä¸‹3ç§ç±»å‹ï¼š <ul><li>Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—</li><li>Directï¼šå®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting keyçš„é˜Ÿåˆ—</li><li>Topicï¼šé€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰çš„é˜Ÿåˆ—</li></ul></li></ul><blockquote><p><em>Exchange</em>ï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸Exchangeç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±</p></blockquote><p><strong>ç”Ÿäº§è€…</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ08æ—¥ 15:10
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PubSub</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.åˆ›å»ºè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.23.129&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.åˆ›å»ºè¿æ¥Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.åˆ›å»ºchannel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5. åˆ›å»ºäº¤æ¢æœº</span>
            <span class="token comment">// exchangeï¼šäº¤æ¢æœºåç§°</span>
            <span class="token comment">// typeï¼šäº¤æ¢æœºç±»å‹ï¼ˆé€šè¿‡æšä¸¾ç±»å‹è°ƒç”¨é€‰æ‹©BuiltinExchangeTypeï¼‰</span>
                <span class="token comment">// DIRECT(&quot;direct&quot;)ï¼šå®šå‘</span>
                <span class="token comment">// FANOUT(&quot;fanout&quot;)ï¼šæ‰‡å½¢ï¼ˆå¹¿æ’­ï¼‰ã€‚å‘é€æ¶ˆæ¯åˆ°æ¯ä¸€ä¸ªä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</span>
                <span class="token comment">// TOPIC(&quot;topic&quot;)ï¼šé€šé…ç¬¦çš„æ–¹å¼</span>
                <span class="token comment">// HEADERS(&quot;headers&quot;)ï¼šå‚æ•°åŒ¹é…ï¼ˆç”¨çš„å°‘ï¼‰</span>
            <span class="token comment">// durableï¼šæ˜¯å¦æŒä¹…åŒ–</span>
            <span class="token comment">// autoDeleteï¼šæ˜¯å¦è‡ªåŠ¨åˆ é™¤</span>
            <span class="token comment">// internalï¼šå†…éƒ¨ä½¿ç”¨ï¼ˆä¸€èˆ¬è®¾ä¸ºfalseï¼‰</span>
            <span class="token comment">// argumentsï¼šå‚æ•°</span>
        <span class="token class-name">String</span> exchangeName <span class="token operator">=</span> <span class="token string">&quot;test_fanout&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">FANOUT</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6. åˆ›å»ºé˜Ÿåˆ—</span>
        <span class="token class-name">String</span> queue1Name <span class="token operator">=</span> <span class="token string">&quot;test_fanout_queue1&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queue2Name <span class="token operator">=</span> <span class="token string">&quot;test_fanout_queue2&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queue1Name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queue2Name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 7. ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span>
            <span class="token comment">// queueï¼šé˜Ÿåˆ—åç§°</span>
            <span class="token comment">// exchangeï¼šäº¤æ¢æœºåç§°</span>
            <span class="token comment">// routingKeyï¼šè·¯ç”±é”®ï¼Œç»‘å®šè§„åˆ™</span>
                <span class="token comment">// å¦‚æœäº¤æ¢æœºçš„ç±»å‹ä¸ºfanoutï¼ŒroutingKeyè®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²&quot;&quot;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue1Name<span class="token punctuation">,</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue2Name<span class="token punctuation">,</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 8. å‘é€æ¶ˆæ¯</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token string">&quot;æ—¥å¿—ä¿¡æ¯ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 9. é‡Šæ”¾èµ„æº</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¶ˆè´¹è€…</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ08æ—¥ 17:39
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PubSub1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.23.129&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºchannel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¥æ”¶æ¶ˆæ¯</span>
        <span class="token class-name">Consumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ§åˆ¶å°ï¼š&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queue1Name <span class="token operator">=</span> <span class="token string">&quot;test_fanout_queue1&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queue2Name <span class="token operator">=</span> <span class="token string">&quot;test_fanout_queue2&quot;</span><span class="token punctuation">;</span>

        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue1Name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¶ˆè´¹è€…ä¸éœ€è¦å…³é—­èµ„æºï¼Œéœ€è¦ä¸€ç›´ä¿æŒç›‘å¬çŠ¶æ€</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="routingè·¯ç”±æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#routingè·¯ç”±æ¨¡å¼" aria-hidden="true">#</a> Routingè·¯ç”±æ¨¡å¼</h4><ul><li>é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ªRoutingKeyï¼ˆè·¯ç”±keyï¼‰</li><li>æ¶ˆæ¯çš„å‘é€æ–¹åœ¨å‘Exchangeå‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„RoutingKey</li><li>Exchangeä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„Routing Keyè¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„RoutingKeyä¸æ¶ˆæ¯çš„Routing Keyå®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯</li></ul><p><img src="http://images.hellocode.top/python-four.png" alt="img" loading="lazy"></p><p><strong>å›¾è§£</strong></p><ul><li>Pï¼šç”Ÿäº§è€…ï¼Œå‘Exchangeå‘é€æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šæŒ‡å®šä¸€ä¸ªrouting key</li><li>Xï¼šExchangeï¼ˆäº¤æ¢æœºï¼‰ï¼Œæ¥æ”¶ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œç„¶åæŠŠæ¶ˆæ¯é€’äº¤ç»™ä¸routing keyå®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—</li><li>C1ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦routing keyä¸ºerrorçš„æ¶ˆæ¯</li><li>C2ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦routing keyä¸ºinfoã€errorã€warningçš„æ¶ˆæ¯</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ08æ—¥ 15:10
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoutingKey</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.åˆ›å»ºè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.23.129&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.åˆ›å»ºè¿æ¥Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.åˆ›å»ºchannel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5. åˆ›å»ºäº¤æ¢æœº</span>
        <span class="token class-name">String</span> exchangeName <span class="token operator">=</span> <span class="token string">&quot;test_direct&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6. åˆ›å»ºé˜Ÿåˆ—</span>
        <span class="token class-name">String</span> queue1Name <span class="token operator">=</span> <span class="token string">&quot;test_direct_queue1&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queue2Name <span class="token operator">=</span> <span class="token string">&quot;test_direct_queue2&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queue1Name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queue2Name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 7. ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue1Name<span class="token punctuation">,</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue2Name<span class="token punctuation">,</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue2Name<span class="token punctuation">,</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue2Name<span class="token punctuation">,</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;warning&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 8. å‘é€æ¶ˆæ¯</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token string">&quot;æ—¥å¿—ä¿¡æ¯ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 9. é‡Šæ”¾èµ„æº</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ08æ—¥ 17:39
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoutingKey1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.23.129&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºchannel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¥æ”¶æ¶ˆæ¯</span>
        <span class="token class-name">Consumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ•°æ®åº“ï¼š&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queue1Name <span class="token operator">=</span> <span class="token string">&quot;test_direct_queue1&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queue2Name <span class="token operator">=</span> <span class="token string">&quot;test_direct_queue2&quot;</span><span class="token punctuation">;</span>

        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue1Name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¶ˆè´¹è€…ä¸éœ€è¦å…³é—­èµ„æºï¼Œéœ€è¦ä¸€ç›´ä¿æŒç›‘å¬çŠ¶æ€</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>Routing</strong> æ¨¡å¼è¦æ±‚é˜Ÿåˆ—åœ¨ç»‘å®šäº¤æ¢æœºæ—¶è¦æŒ‡å®š<strong>routing key</strong>ï¼Œæ¶ˆæ¯ä¼šè½¬å‘åˆ°ç¬¦åˆrouting keyçš„é˜Ÿåˆ—</p></blockquote><h4 id="topicsé€šé…ç¬¦æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#topicsé€šé…ç¬¦æ¨¡å¼" aria-hidden="true">#</a> Topicsé€šé…ç¬¦æ¨¡å¼</h4><p><img src="http://images.hellocode.top/python-five.png" alt="img" loading="lazy"></p><ul><li>äº¤æ¢æœºç±»å‹ï¼štopic</li><li>é€šé…ç¬¦ï¼š<code>*</code>ä»£è¡¨ä¸€ä¸ªå•è¯ï¼Œ<code>#</code>ä»£è¡¨0ä¸ªæˆ–å¤šä¸ªï¼ˆ.åˆ†éš”ï¼Œ#å¯ä»¥ä»£è¡¨ä»»æ„å¤šä¸ª.åˆ†éš”çš„å•è¯ï¼‰ æ³¨æ„å±‚çº§å…³ç³»ï¼Œ*ä¸€å±‚ï¼Œ#ä»»æ„å¤šå±‚</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ08æ—¥ 15:10
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Topic</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.åˆ›å»ºè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.23.129&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.åˆ›å»ºè¿æ¥Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.åˆ›å»ºchannel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5. åˆ›å»ºäº¤æ¢æœº</span>
        <span class="token class-name">String</span> exchangeName <span class="token operator">=</span> <span class="token string">&quot;test_topic&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">TOPIC</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6. åˆ›å»ºé˜Ÿåˆ—</span>
        <span class="token class-name">String</span> queue1Name <span class="token operator">=</span> <span class="token string">&quot;test_topic_queue1&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queue2Name <span class="token operator">=</span> <span class="token string">&quot;test_topic_queue2&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queue1Name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queue2Name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 7. ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue1Name<span class="token punctuation">,</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;#.error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue1Name<span class="token punctuation">,</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;order.*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue2Name<span class="token punctuation">,</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;*.*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 8. å‘é€æ¶ˆæ¯</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token string">&quot;æ—¥å¿—ä¿¡æ¯ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span><span class="token string">&quot;goods.error&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 9. é‡Šæ”¾èµ„æº</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ08æ—¥ 17:39
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Topic1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.23.129&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;hellocode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºè¿æ¥Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºchannel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¥æ”¶æ¶ˆæ¯</span>
        <span class="token class-name">Consumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ•°æ®åº“ï¼š&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queue1Name <span class="token operator">=</span> <span class="token string">&quot;test_topic_queue1&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queue2Name <span class="token operator">=</span> <span class="token string">&quot;test_topic_queue2&quot;</span><span class="token punctuation">;</span>

        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue1Name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¶ˆè´¹è€…ä¸éœ€è¦å…³é—­èµ„æºï¼Œéœ€è¦ä¸€ç›´ä¿æŒç›‘å¬çŠ¶æ€</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Topicä¸»é¢˜æ¨¡å¼å¯ä»¥å®ç°Pub/Subå‘å¸ƒä¸è®¢é˜…æ¨¡å¼å’ŒRoutingè·¯ç”±æ¨¡å¼çš„åŠŸèƒ½ï¼Œåªæ˜¯Topicåœ¨é…ç½®routing keyçš„æ—¶å€™å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œæ˜¾å¾—æ›´åŠ çµæ´»</p></blockquote><h4 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h4><ol><li>ç®€å•æ¨¡å¼ HelloWorld ä¸€ä¸ªç”Ÿäº§è€…ã€ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰</li><li>å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ Work Queue ä¸€ä¸ªç”Ÿäº§è€…ã€å¤šä¸ªæ¶ˆè´¹è€…ï¼ˆç«äº‰å…³ç³»ï¼‰ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰</li><li>å‘å¸ƒè®¢é˜…æ¨¡å¼ Publish/Subscribe éœ€è¦è®¾ç½®ç±»å‹ä¸ºfanoutçš„äº¤æ¢æœºï¼Œå¹¶ä¸”äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šå°†æ¶ˆæ¯å‘é€åˆ°ç»‘å®šçš„é˜Ÿåˆ—</li><li>è·¯ç”±æ¨¡å¼ Routing éœ€è¦è®¾ç½®ç±»å‹ä¸º directçš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®šrouting keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ®routing keyå°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—</li><li>é€šé…ç¬¦æ¨¡å¼ Topic éœ€è¦è®¾ç½®ç±»å‹ä¸º topic çš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®šé€šé…ç¬¦æ–¹å¼çš„ routing keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ®routing keyå°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—</li></ol><h3 id="springæ•´åˆ" tabindex="-1"><a class="header-anchor" href="#springæ•´åˆ" aria-hidden="true">#</a> Springæ•´åˆ</h3><h4 id="spring" tabindex="-1"><a class="header-anchor" href="#spring" aria-hidden="true">#</a> Spring</h4><p><strong>ç”Ÿäº§è€…</strong></p><ol><li>åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹</li><li>æ·»åŠ ä¾èµ–</li><li>é…ç½®æ•´åˆ</li><li>ç¼–å†™ä»£ç å‘é€æ¶ˆæ¯</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-rabbit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.8.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">rabbitmq.host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.23.129</span>
<span class="token key attr-name">rabbitmq.port</span><span class="token punctuation">=</span><span class="token value attr-value">5672</span>
<span class="token key attr-name">rabbitmq.username</span><span class="token punctuation">=</span><span class="token value attr-value">hellocode</span>
<span class="token key attr-name">rabbitmq.password</span><span class="token punctuation">=</span><span class="token value attr-value">hellocode</span>
<span class="token key attr-name">rabbitmq.virtual-host</span><span class="token punctuation">=</span><span class="token value attr-value">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>rabbit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/rabbit<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/rabbit
       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:properties/rabbitmq.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- å®šä¹‰rabbitmq connectionFactory --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>connection-factory</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.host}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.port}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.username}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.password}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">virtual-host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.virtual-host}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--å®šä¹‰ç®¡ç†äº¤æ¢æœºã€é˜Ÿåˆ—--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>admin</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--å®šä¹‰æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºï¼›ä¸ç»‘å®šåˆ°äº¤æ¢æœºåˆ™ç»‘å®šåˆ°é»˜è®¤äº¤æ¢æœº
    é»˜è®¤äº¤æ¢æœºç±»å‹ä¸ºdirectï¼Œåå­—ä¸ºï¼š&quot;&quot;ï¼Œè·¯ç”±é”®ä¸ºé˜Ÿåˆ—çš„åç§°
		idï¼šbeançš„åç§°
		nameï¼šqueueçš„åç§°
		autoâ€”declareï¼šä¸å­˜åœ¨æ˜¯å¦è‡ªåŠ¨åˆ›å»º
		auto-deleteï¼šè‡ªåŠ¨åˆ é™¤ã€‚æœ€åä¸€ä¸ªæ¶ˆè´¹è€…å’Œè¯¥é˜Ÿåˆ—æ–­å¼€è¿æ¥åï¼Œè‡ªåŠ¨åˆ é™¤
		durableï¼šæ˜¯å¦æŒä¹…åŒ–
		exclusiveï¼šæ˜¯å¦ç‹¬å 
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_queue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_queue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~å¹¿æ’­ï¼›æ‰€æœ‰é˜Ÿåˆ—éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --&gt;</span>
    <span class="token comment">&lt;!--å®šä¹‰å¹¿æ’­äº¤æ¢æœºä¸­çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_fanout_queue_1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_fanout_queue_1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--å®šä¹‰å¹¿æ’­äº¤æ¢æœºä¸­çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_fanout_queue_2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_fanout_queue_2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--å®šä¹‰å¹¿æ’­ç±»å‹äº¤æ¢æœºï¼›å¹¶ç»‘å®šä¸Šè¿°ä¸¤ä¸ªé˜Ÿåˆ—--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>fanout-exchange</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_fanout_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_fanout_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_fanout_queue_1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_fanout_queue_2<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>fanout-exchange</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~é€šé…ç¬¦ï¼›*åŒ¹é…ä¸€ä¸ªå•è¯ï¼Œ#åŒ¹é…å¤šä¸ªå•è¯ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --&gt;</span>
    <span class="token comment">&lt;!--å®šä¹‰å¹¿æ’­äº¤æ¢æœºä¸­çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_star<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_star<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--å®šä¹‰å¹¿æ’­äº¤æ¢æœºä¸­çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_well<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_well<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--å®šä¹‰å¹¿æ’­äº¤æ¢æœºä¸­çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_well2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_well2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>topic-exchange</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heima.*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_star<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heima.#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_well<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>itcast.#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_well2<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>topic-exchange</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--å®šä¹‰rabbitTemplateå¯¹è±¡æ“ä½œå¯ä»¥åœ¨ä»£ç ä¸­æ–¹ä¾¿å‘é€æ¶ˆæ¯--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rabbitTemplate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ09æ—¥ 17:47
 */</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:spring-rabbitmq-producer.xml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProducerTest</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. æ³¨å…¥ RabbitTemplates</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHelloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 2. å‘é€æ¶ˆæ¯</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;spring_queue&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello world spring...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å‘é€fanoutæ¶ˆæ¯</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFanout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;spring_fanout_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;spring fanout...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å‘é€topicæ¶ˆæ¯</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;spring_topic_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;heima.test&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;spring topic...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¶ˆè´¹è€…</strong></p><ol><li>åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹</li><li>æ·»åŠ ä¾èµ–</li><li>é…ç½®æ•´åˆ</li><li>ç¼–å†™æ¶ˆæ¯ç›‘å¬å™¨</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>rabbit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/rabbit<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/rabbit
       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:rabbitmq.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- å®šä¹‰rabbitmq connectionFactory --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>connection-factory</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.host}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.port}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.username}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.password}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">virtual-host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.virtual-host}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>springQueueListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top.hellocode.rabbitmq.listener.SpringQueueListener<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanoutListener1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top.hellocode.rabbitmq.listener.FanoutListener1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanoutListener2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top.hellocode.rabbitmq.listener.FanoutListener2<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topicListenerStar<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top.hellocode.rabbitmq.listener.TopicListenerStar<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topicListenerWell<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top.hellocode.rabbitmq.listener.TopicListenerWell<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topicListenerWell2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top.hellocode.rabbitmq.listener.TopicListenerWell2<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener-container</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>springQueueListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_queue<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanoutListener1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_fanout_queue_1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanoutListener2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_fanout_queue_2<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topicListenerStar<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_star<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topicListenerWell<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_well<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topicListenerWell2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spring_topic_queue_well2<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>listener-container</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ09æ—¥ 17:57
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringQueueListener</span> <span class="token keyword">implements</span> <span class="token class-name">MessageListener</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ09æ—¥ 17:59
 */</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:spring-rabbitmq-consumer.xml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// åªéœ€è¦æ‰§è¡Œæµ‹è¯•ç±»ï¼Œè¯»å–é…ç½®æ–‡ä»¶å³å¯ï¼Œè¿™é‡Œä½¿ç”¨å¾ªç¯è®©ç›‘å¬å™¨å¤„äºå·¥ä½œçŠ¶æ€</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="springboot" tabindex="-1"><a class="header-anchor" href="#springboot" aria-hidden="true">#</a> SpringBoot</h4><p><strong>ç”Ÿäº§è€…</strong></p><ol><li><p>åˆ›å»ºç”Ÿäº§è€…SpringBootå·¥ç¨‹</p></li><li><p>å¼•å…¥ä¾èµ–åæ ‡</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç¼–å†™ymlé…ç½®ï¼ŒåŸºæœ¬ä¿¡æ¯é…ç½®</p></li><li><p>å®šä¹‰äº¤æ¢æœºï¼Œé˜Ÿåˆ—ä»¥åŠç»‘å®šå…³ç³»çš„é…ç½®ç±»</p></li><li><p>æ³¨å…¥RabbitTemplateï¼Œè°ƒç”¨æ–¹æ³•ï¼Œå®Œæˆæ¶ˆæ¯å‘é€</p></li></ol><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.23.129
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> hellocode
    <span class="token key atrule">password</span><span class="token punctuation">:</span> hellocode
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ09æ—¥ 18:38
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RabbitMQConfig</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;boot_topic_exchange&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;boot_queue&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// äº¤æ¢æœº</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;bootExchange&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Exchange</span> <span class="token function">bootExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ExchangeBuilder</span><span class="token punctuation">.</span><span class="token function">topicExchange</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Queueé˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;bootQueue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">bootQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// é˜Ÿåˆ—å’Œäº¤æ¢æœºç»‘å®šå…³ç³»  Binding</span>
        <span class="token comment">// 1. çŸ¥é“å“ªä¸ªé˜Ÿåˆ—</span>
        <span class="token comment">// 2. çŸ¥é“å“ªä¸ªäº¤æ¢æœº</span>
        <span class="token comment">// 3. routing key</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">bindQueueExchange</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;bootQueue&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span> <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;bootExchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Exchange</span> exchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;boot.#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noargs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">ProducerSpringbootApplicationTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token class-name">RabbitMQConfig</span><span class="token punctuation">.</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span><span class="token string">&quot;boot.test&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;boot mq hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¶ˆè´¹è€…</strong></p><ol><li>åˆ›å»ºSpringBootå·¥ç¨‹</li><li>å¼•å…¥startä¾èµ–åæ ‡</li><li>ç¼–å†™ymlé…ç½®ï¼ŒåŸºæœ¬ä¿¡æ¯é…ç½®</li><li>å®šä¹‰ç›‘å¬ç±»ï¼Œä½¿ç”¨<code>@RabbitListener</code>æ³¨è§£å®Œæˆé˜Ÿåˆ—ç›‘å¬</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ09æ—¥ 19:04
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RabbitMQListener</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;boot_queue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">ListenerQueue</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å®šä¹‰å®Œç›‘å¬ç±»ï¼Œå¯åŠ¨å¯åŠ¨ç±»å³å¯</p></blockquote><ul><li>åŸºæœ¬ä¿¡æ¯åœ¨ymlä¸­é…ç½®ï¼Œé˜Ÿåˆ—äº¤æ¢æœºä»¥åŠç»‘å®šå…³ç³»åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨Beançš„æ–¹å¼é…ç½®</li><li>ç”Ÿäº§ç«¯ç›´æ¥æ³¨å…¥RabbitTemplateå®Œæˆæ¶ˆæ¯å‘é€</li><li>æ¶ˆè´¹ç«¯ç›´æ¥ä½¿ç”¨<code>@RabbitListener</code>å®Œæˆæ¶ˆæ¯æ¥æ”¶</li></ul><h3 id="é«˜çº§ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#é«˜çº§ç‰¹æ€§" aria-hidden="true">#</a> é«˜çº§ç‰¹æ€§</h3><h4 id="æ¶ˆæ¯å¯é æŠ•é€’" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯å¯é æŠ•é€’" aria-hidden="true">#</a> æ¶ˆæ¯å¯é æŠ•é€’</h4><p>åœ¨ä½¿ç”¨RabbitMQçš„æ—¶å€™ï¼Œä½œä¸ºæ¶ˆæ¯å‘é€æ–¹å¸Œæœ›æœç»ä»»ä½•æ¶ˆæ¯ä¸¢å¤±æˆ–è€…æŠ•é€’å¤±è´¥çš„åœºæ™¯ã€‚RabbitMQä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§æ–¹å¼æ¥æ§åˆ¶æ¶ˆæ¯çš„æŠ•é€’å¯é æ€§æ¨¡å¼</p><ul><li>confirm ç¡®è®¤æ¨¡å¼</li><li>return é€€å›æ¨¡å¼</li></ul><p>rabbitmqæ•´ä¸ªæ¶ˆæ¯æŠ•é€’çš„è·¯å¾„ä¸ºï¼š</p><p>producer---&gt;rabbitmq broker---&gt;exchange---&gt;queue---&gt;consumer</p><ul><li>æ¶ˆæ¯ä»produceråˆ°exchangeä¼šè¿”å›ä¸€ä¸ªconfirmCallbackï¼Œä¸è®ºæˆåŠŸä¸å¦éƒ½ä¼šæ‰§è¡Œï¼Œè¿”å›boolean</li><li>æ¶ˆæ¯ä»exchange--&gt;queueæŠ•é€’å¤±è´¥åˆ™ä¼šè¿”å›ä¸€ä¸ªreturnCallback</li></ul><p>æˆ‘ä»¬å°†åˆ©ç”¨è¿™ä¸¤ä¸ªcallbackæ§åˆ¶æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’</p><p><strong>confirmç¡®è®¤æ¨¡å¼</strong></p><ol><li>ç¡®è®¤æ¨¡å¼å¼€å¯ï¼šåœ¨springé…ç½®æ–‡ä»¶ConnectionFactoryä¸­å¼€å¯ publisher-confirms=&quot;true&quot;</li><li>åœ¨rabbitTemplateä¸­å®šä¹‰ConfirmCallBackå›è°ƒå‡½æ•°</li><li>å‘é€æ¶ˆæ¯</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>rabbit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/rabbit<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/rabbit
       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:rabbitmq.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- å®šä¹‰rabbitmq connectionFactory --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>connection-factory</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.host}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.port}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.username}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.password}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">virtual-host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.virtual-host}<span class="token punctuation">&quot;</span></span>
                                <span class="token attr-name">publisher-confirms</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--å®šä¹‰ç®¡ç†äº¤æ¢æœºã€é˜Ÿåˆ—--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>admin</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--å®šä¹‰rabbitTemplateå¯¹è±¡æ“ä½œå¯ä»¥åœ¨ä»£ç ä¸­æ–¹ä¾¿å‘é€æ¶ˆæ¯--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rabbitTemplate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--æ¶ˆæ¯å¯é æ€§æŠ•é€’ï¼ˆç”Ÿäº§ç«¯ï¼‰--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_confirm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_confirm<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>direct-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_exchange_confirm<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_confirm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>confirm<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>direct-exchange</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ12æ—¥ 17:19
 */</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:spring-rabbitmq-producer.xml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProducerTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token comment">/*
    * ç¡®è®¤æ¨¡å¼ï¼š
    *   æ­¥éª¤ï¼š
    *       1. ç¡®è®¤æ¨¡å¼å¼€å¯ï¼šåœ¨springé…ç½®æ–‡ä»¶ConnectionFactoryä¸­å¼€å¯   publisher-confirms=&quot;true&quot;
    *       2ã€ åœ¨rabbitTemplateä¸­å®šä¹‰ConfirmCallBackå›è°ƒå‡½æ•°
    *       3ã€ å‘é€æ¶ˆæ¯
    * */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testConfirm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 2. å®šä¹‰å›è°ƒ</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/*
            * correlationDataï¼šç›¸å…³é…ç½®ä¿¡æ¯
            * ackï¼šexchangeäº¤æ¢æœºï¼Œæ˜¯å¦æˆåŠŸæ”¶åˆ°äº†æ¶ˆæ¯ã€‚trueæˆåŠŸï¼Œfalseå¤±è´¥
            * causeï¼šå¤±è´¥åŸå› 
            * */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;confirmæ‰§è¡Œäº†.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;exchangeæ¥æ”¶æ¶ˆæ¯å¤±è´¥ï¼š&quot;</span> <span class="token operator">+</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.å‘é€æ¶ˆæ¯</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;test_exchange_confirm&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;confirm&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>returné€€å›æ¨¡å¼</strong></p><ol><li>å¼€å¯å›é€€æ¨¡å¼ï¼špublisher-returns=&quot;true&quot;</li><li>è®¾ç½®ReturnCallBack</li><li>è®¾ç½®Exchangeå¤„ç†æ¶ˆæ¯çš„æ¨¡å¼ <ul><li>å¦‚æœæ¶ˆæ¯æ²¡æœ‰è·¯ç”±åˆ°Queueï¼Œåˆ™ä¸¢å¼ƒæ¶ˆæ¯ï¼ˆé»˜è®¤ï¼‰</li><li>å¦‚æœæ¶ˆæ¯æ²¡æœ‰è·¯ç”±åˆ°Queueï¼Œè¿”å›ç»™æ¶ˆæ¯å‘é€æ–¹ReturnCallBack</li></ul></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// è®¾ç½®äº¤æ¢æœºå¤„ç†å¤±è´¥æ¶ˆæ¯çš„æ¨¡å¼</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setMandatory</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//è®¾ç½®å¤±è´¥åå°†æ¶ˆæ¯è¿”å›ç»™å‘é€æ–¹</span>

    <span class="token comment">// 2. å®šä¹‰å›è°ƒ</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         * <span class="token keyword">@param</span> <span class="token parameter">message</span>: æ¶ˆæ¯å¯¹è±¡
         * <span class="token keyword">@param</span> <span class="token parameter">replyCode</span>: é”™è¯¯ç 
         * <span class="token keyword">@param</span> <span class="token parameter">replyText</span>: é”™è¯¯ä¿¡æ¯
         * <span class="token keyword">@param</span> <span class="token parameter">exchange</span>: äº¤æ¢æœº
         * <span class="token keyword">@param</span> <span class="token parameter">routingKey</span>: è·¯ç”±é”®
         */</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> replyCode<span class="token punctuation">,</span> <span class="token class-name">String</span> replyText<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//(Body:&#39;message.....&#39; MessageProperties [headers={}, contentType=text/plain, contentEncoding=UTF-8, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, deliveryTag=0])</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>replyCode<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//312</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>replyText<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//NO_ROUTE</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//test_exchange_confirm</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>routingKey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//confirm111</span>
            
            <span class="token comment">// å¤„ç†</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.å‘é€æ¶ˆæ¯</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;test_exchange_confirm&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;confirm111&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>returné€€å›æ¨¡å¼åªæœ‰äº¤æ¢æœºæ¥æ”¶æ¶ˆæ¯å¤±è´¥æ‰æœ‰æœºä¼šæ‰§è¡Œå›è°ƒå‡½æ•°</p><p>é»˜è®¤ä¸¢å¼ƒæ¶ˆæ¯ï¼Œè¿™å°†ä¸ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œåªæœ‰ä½¿ç”¨<code>rabbitTemplate.setMandatory(true);</code>è®¾ç½®äº¤æ¢æœºå¤„ç†å¤±è´¥æ¶ˆæ¯çš„æ¨¡å¼ä¸ºé€€å›æ¶ˆæ¯å‘é€æ–¹ï¼Œæ‰ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°</p></blockquote><blockquote><p>åœ¨RabbitMQä¸­ä¹Ÿæä¾›äº†äº‹åŠ¡æœºåˆ¶ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®ï¼Œåªéœ€è¦äº†è§£å³å¯</p><p>ä½¿ç”¨channelä¸‹åˆ—æ–¹æ³•ï¼Œå®Œæˆäº‹åŠ¡æ§åˆ¶ï¼š</p><ul><li><code>txSelect()</code>ï¼šç”¨äºå°†å½“å‰channelè®¾ç½®æˆtransactionæ¨¡å¼</li><li><code>txCommit()</code>ï¼šç”¨äºæäº¤äº‹åŠ¡</li><li><code>txRollback()</code>ï¼šç”¨äºå›æ»šäº‹åŠ¡</li></ul></blockquote><h4 id="consumer-ack" tabindex="-1"><a class="header-anchor" href="#consumer-ack" aria-hidden="true">#</a> Consumer Ack</h4><blockquote><p>ackæŒ‡Acknowledgeï¼Œç¡®è®¤ã€‚è¡¨ç¤ºæ¶ˆè´¹ç«¯æ”¶åˆ°æ¶ˆæ¯åçš„ç¡®è®¤æ–¹å¼</p></blockquote><p>æœ‰ä¸‰ç§ç¡®è®¤æ–¹å¼ï¼š</p><ul><li>è‡ªåŠ¨ç¡®è®¤ï¼š<code>acknowledge=&quot;none&quot;</code></li><li>æ‰‹åŠ¨ç¡®è®¤ï¼š<code>acknowledge=&quot;manual&quot;</code></li><li>æ ¹æ®å¼‚å¸¸æƒ…å†µç¡®è®¤ï¼š<code>acknowledge=&quot;auto&quot;</code>ï¼ˆè¿™ç§æ–¹å¼ä½¿ç”¨éº»çƒ¦ï¼Œä¸æ¨èï¼‰</li></ul><p>å…¶ä¸­è‡ªåŠ¨ç¡®è®¤æ˜¯æŒ‡ï¼Œå½“æ¶ˆæ¯ä¸€æ—¦è¢«Consumeræ¥æ”¶åˆ°ï¼Œåˆ™è‡ªåŠ¨ç¡®è®¤æ”¶åˆ°ï¼Œå¹¶ä½œå‡ºç›¸åº”messageä»RabbitMQçš„æ¶ˆæ¯ç¼“å­˜ä¸­ç§»é™¤ã€‚ä½†æ˜¯åœ¨å®é™…ä¸šåŠ¡å¤„ç†ä¸­ï¼Œå¾ˆå¯èƒ½æ¶ˆæ¯æ¥æ”¶åˆ°ï¼Œä¸šåŠ¡å¤„ç†å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚å¦‚æœè®¾ç½®äº†æ‰‹åŠ¨ç¡®è®¤æ–¹å¼ï¼Œåˆ™éœ€è¦åœ¨ä¸šåŠ¡å¤„ç†æˆåŠŸåï¼Œè°ƒç”¨<code>channel.basicAck()</code>ï¼Œæ‰‹åŠ¨ç­¾æ”¶ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨<code>channel.basicNack()</code>æˆ–<code>basicReject()</code>æ–¹æ³•ï¼Œè®©å…¶è‡ªåŠ¨é‡æ–°å‘é€æ¶ˆæ¯</p><p><strong>Consumer ACKæœºåˆ¶</strong></p><ol><li>è®¾ç½®æ‰‹åŠ¨ç­¾æ”¶ã€‚<code>rabbit:listener-container</code>ä¸­çš„å±æ€§ï¼š<code>acknowledge=&quot;manual&quot;</code></li><li>è®©ç›‘å¬å™¨å®ç°ChannelAwareMessageListeneræ¥å£</li><li>å¦‚æœæ¶ˆæ¯æˆåŠŸå¤„ç†ï¼Œåˆ™è°ƒç”¨channelçš„basicAckæ–¹æ³•ç­¾æ”¶</li><li>å¦‚æœæ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œåˆ™è°ƒç”¨channelçš„basicNackæ–¹æ³•æ‹’ç»ç­¾æ”¶ï¼Œbrokeré‡æ–°å‘é€ç»™consumer</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>rabbit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/rabbit<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/rabbit
       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:rabbitmq.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- å®šä¹‰rabbitmq connectionFactory --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>connection-factory</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.host}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.port}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.username}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.password}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">virtual-host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.virtual-host}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--å®šä¹‰ç›‘å¬å™¨bean--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top.hellocode.listener<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--å®šä¹‰ç›‘å¬å™¨å®¹å™¨--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener-container</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">acknowledge</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manual<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ackListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_confirm<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>listener-container</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ12æ—¥ 18:18
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AckListener</span> <span class="token keyword">implements</span> <span class="token class-name">ChannelAwareMessageListener</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> deliveryTag <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1. æ¥æ”¶è½¬æ¢æ¶ˆæ¯</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2. å¤„ç†ä¸šåŠ¡é€»è¾‘</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¤„ç†ä¸šåŠ¡é€»è¾‘....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">// æ‰‹åŠ¨ç­¾æ”¶</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>deliveryTag<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ‹’ç»ç­¾æ”¶</span>
            <span class="token comment">// ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šrequeueï¼Œé‡å›é˜Ÿåˆ—ã€‚å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™æ¶ˆæ¯é‡æ–°å›åˆ°queueï¼Œbrokerä¼šé‡æ–°å‘é€è¯¥æ¶ˆæ¯ç»™æ¶ˆè´¹ç«¯</span>
            channel<span class="token punctuation">.</span><span class="token function">basicNack</span><span class="token punctuation">(</span>deliveryTag<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:spring-rabbitmq-consumer.xml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ¶ˆè´¹ç«¯é™æµ" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹ç«¯é™æµ" aria-hidden="true">#</a> æ¶ˆè´¹ç«¯é™æµ</h4><p><img src="http://images.hellocode.top/2115723-20210309020755148-205864159.png" alt="image-20210219023003482" loading="lazy"></p><p><strong>Consumeré™æµæœºåˆ¶</strong></p><ol><li>ç¡®ä¿ackæœºåˆ¶ä¸ºæ‰‹åŠ¨ç¡®è®¤(<code>acknowledge=&quot;manual&quot;</code>)</li><li>åœ¨é…ç½®æ–‡ä»¶ä¸­<code>rabbit:listener-container</code>ä¸­é…ç½®å±æ€§ <code>perfetch = &quot;n&quot;</code>ï¼Œæ¯æ¬¡ä»MQä¸­æ‹‰å–næ¡æ¶ˆæ¯ï¼Œåªæœ‰æ‰‹åŠ¨ç¡®è®¤æ¶ˆè´¹å®Œæ¯•ï¼Œæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ¬¡æ‹‰å–</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--å®šä¹‰ç›‘å¬å™¨å®¹å™¨--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener-container</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">acknowledge</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manual<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prefetch</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--&lt;rabbit:listener ref=&quot;ackListener&quot; queue-names=&quot;test_queue_confirm&quot;/&gt;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>qosListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_confirm<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>listener-container</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> HelloCode
 * <span class="token keyword">@site</span> https://www.hellocode.top
 * <span class="token keyword">@date</span> 2022å¹´09æœˆ12æ—¥ 18:18
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QosListener</span> <span class="token keyword">implements</span> <span class="token class-name">ChannelAwareMessageListener</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. è·å–æ¶ˆæ¯</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. å¤„ç†ä¸šåŠ¡é€»è¾‘</span>

        <span class="token comment">// 3. ç­¾æ”¶</span>
        channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ttl" tabindex="-1"><a class="header-anchor" href="#ttl" aria-hidden="true">#</a> TTL</h4><ul><li>TTLå…¨ç§°Time To Liveï¼ˆå­˜æ´»æ—¶é—´/è¿‡æœŸæ—¶é—´ï¼‰</li><li>å½“æ¶ˆæ¯åˆ°è¾¾å­˜æ´»æ—¶é—´åï¼Œè¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œä¼šè¢«è‡ªåŠ¨æ¸…é™¤</li><li>RabbitMQå¯ä»¥å¯¹æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå¯ä»¥å¯¹æ•´ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰è®¾ç½®è¿‡æœŸæ—¶é—´</li></ul><p><strong>è®¾ç½®é˜Ÿåˆ—è¿‡æœŸ</strong></p><ol><li><p>é…ç½®é˜Ÿåˆ—å‚æ•°ä¿¡æ¯</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--ttl--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_ttl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_ttl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-message-ttl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>topic-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_exchange_ttl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ttl.#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_ttl<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>topic-exchange</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>keyå€¼<code>x-message-ttl</code>æ˜¯é…ç½®ttlçš„å›ºå®šå±æ€§ï¼Œè¿‡æœŸæ—¶é—´å•ä½ä¸ºæ¯«ç§’ï¼Œå› ä¸ºæ˜¯numberç±»å‹ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®štype</p></li><li><p>å‘é€æ¶ˆæ¯ <code>rabbitTemplate.convertAndSend(&quot;test_exchange_ttl&quot;, &quot;ttl.run&quot;, &quot;hello ttl.....&quot;);</code></p></li></ol><blockquote><p>é˜Ÿåˆ—è¿‡æœŸåï¼Œä¼šå°†é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯å…¨éƒ¨ç§»é™¤</p></blockquote><p><strong>è®¾ç½®æ¶ˆæ¯å•ç‹¬è¿‡æœŸ</strong></p><ol><li><p>å®šä¹‰æ¶ˆæ¯åå¤„ç†å¯¹è±¡ï¼Œè®¾ç½®ä¸€äº›æ¶ˆæ¯çš„å‚æ•°ä¿¡æ¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">MessagePostProcessor</span> messagePostProcessor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessagePostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Message</span> <span class="token function">postProcessMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AmqpException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. è®¾ç½®messageæ¶ˆæ¯</span>
        message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span><span class="token string">&quot;5000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼ˆmsï¼‰</span>
        <span class="token comment">// 2.è¿”å›è¯¥æ¶ˆæ¯</span>
        <span class="token keyword">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å‘é€æ¶ˆæ¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;test_exchange_ttl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ttl.run&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello ttl.....&quot;</span><span class="token punctuation">,</span>messagePostProcessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><blockquote><p>å¦‚æœè®¾ç½®äº†æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿè®¾ç½®äº†é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´ï¼Œä»¥æ—¶é—´çŸ­çš„ä¸ºå‡†</p></blockquote><blockquote><p>æ¶ˆæ¯è¿‡æœŸåï¼Œåªæœ‰æ¶ˆæ¯åœ¨é˜Ÿåˆ—çš„é¡¶ç«¯ï¼ˆå¿«è¢«æ¶ˆè´¹ï¼‰ï¼Œæ‰ä¼šåˆ¤æ–­å…¶æ˜¯å¦è¿‡æœŸï¼ˆç§»é™¤æ‰ï¼‰ï¼Œæé«˜æ•ˆç‡</p></blockquote><h4 id="æ­»ä¿¡é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#æ­»ä¿¡é˜Ÿåˆ—" aria-hidden="true">#</a> æ­»ä¿¡é˜Ÿåˆ—</h4><p>æ­»ä¿¡é˜Ÿåˆ—ï¼Œè‹±æ–‡ç¼©å†™ï¼šDLXã€‚Dead Letter Exchangeï¼ˆæ­»ä¿¡äº¤æ¢æœºï¼‰ï¼Œå½“æ¶ˆæ¯ç§°ä¸ºDead messageåï¼Œå¯ä»¥è¢«é‡æ–°å‘é€åˆ°å¦ä¸€ä¸ªäº¤æ¢æœºï¼Œè¿™ä¸ªäº¤æ¢æœºå°±æ˜¯DLX</p><p><img src="http://images.hellocode.top/20210407124404353.png" alt="img" loading="lazy"></p><p><strong>æ¶ˆæ¯ç§°ä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ</strong></p><ol><li>é˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦è¾¾åˆ°é™åˆ¶</li><li>æ¶ˆè´¹è€…æ‹’æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼ŒbasicNack/basicRejectï¼Œå¹¶ä¸”ä¸æŠŠæ¶ˆæ¯é‡æ–°æ”¾å…¥åŸç›®æ ‡é˜Ÿåˆ—ï¼Œ<code>requeue=false</code></li><li>åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯è¿‡æœŸè®¾ç½®ï¼Œæ¶ˆæ¯åˆ°è¾¾è¶…æ—¶æ—¶é—´æœªè¢«æ¶ˆè´¹</li></ol><p><strong>é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº</strong></p><ul><li>ç»™é˜Ÿåˆ—è®¾ç½®å‚æ•°ï¼š<code>x-dead-letter-exchange</code>å’Œ<code>x-dead-letter-routing-key</code></li></ul><p><strong>æ­¥éª¤</strong>ï¼š</p><ol><li>å£°æ˜æ­£å¸¸çš„é˜Ÿåˆ—å’Œäº¤æ¢æœº</li><li>å£°æ˜æ­»ä¿¡é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœº</li><li>æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºï¼Œè®¾ç½®ä¸¤ä¸ªå‚æ•° <ul><li>x-dead-letter-exchangeï¼šæ­»ä¿¡äº¤æ¢æœºåç§°</li><li>x-dead-letter-routing-keyï¼šå‘é€ç»™æ­»ä¿¡äº¤æ¢æœºçš„routing key</li></ul></li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--æ­»ä¿¡é˜Ÿåˆ—--&gt;</span>
<span class="token comment">&lt;!--1. å£°æ˜æ­£å¸¸çš„é˜Ÿåˆ—äº¤æ¢æœº--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_dlx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--3. æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-dead-letter-exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>exchange_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-dead-letter-routing-key<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dlx.hehe<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token comment">&lt;!--è®¾ç½®é˜Ÿåˆ—è¿‡æœŸæ—¶é—´æˆ–è€…é•¿åº¦é™åˆ¶,è®©æ­»ä¿¡å‡ºç°--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-message-ttl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--é˜Ÿåˆ—é•¿åº¦é™åˆ¶--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-max-length<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>topic-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_exchange_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test.dlx.#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>topic-exchange</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--2. å£°æ˜æ­»ä¿¡é˜Ÿåˆ—äº¤æ¢æœº--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queue_dlx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>topic-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>exchange_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dlx.#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>topic-exchange</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDlx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// æµ‹è¯•è¿‡æœŸæ—¶é—´,æ­»ä¿¡æ¶ˆæ¯</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;test_exchange_dlx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test.dlx.hehe&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æµ‹è¯•é•¿åº¦é™åˆ¶å,æ¶ˆæ¯æ­»ä¿¡</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;test_exchange_dlx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test.dlx.hehe&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å°ç»“</strong></p><ol><li>æ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—å’Œæ™®é€šçš„æ²¡æœ‰åŒºåˆ«</li><li>å½“æ¶ˆæ¯æˆä¸ºæ­»ä¿¡åï¼Œå¦‚æœè¯¥é˜Ÿåˆ—ç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœºï¼Œåˆ™æ¶ˆæ¯ä¼šè¢«æ­»ä¿¡äº¤æ¢æœºé‡æ–°è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—</li><li>æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ <ol><li>é˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦è¾¾åˆ°é™åˆ¶</li><li>æ¶ˆè´¹è€…æ‹’ç»æ¥æ”¶æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸é‡å›é˜Ÿåˆ—</li><li>åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯è¿‡æœŸè®¾ç½®ï¼Œæ¶ˆæ¯è¾¾åˆ°è¶…æ—¶æ—¶é—´æœªè¢«æ¶ˆè´¹</li></ol></li></ol><h4 id="å»¶è¿Ÿé˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#å»¶è¿Ÿé˜Ÿåˆ—" aria-hidden="true">#</a> å»¶è¿Ÿé˜Ÿåˆ—</h4><blockquote><p>å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå³æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—åä¸ä¼šç«‹å³è¢«æ¶ˆè´¹ï¼Œåªæœ‰åˆ°è¾¾æŒ‡å®šæ—¶é—´åï¼Œæ‰ä¼šè¢«æ¶ˆè´¹ï¼ˆéœ€è¦é‡ç‚¹æŒæ¡ï¼‰</p></blockquote><p><strong>éœ€æ±‚</strong></p><ol><li>ä¸‹å•åï¼Œ30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œå–æ¶ˆè®¢å•ï¼Œå›æ»šåº“å­˜</li><li>æ–°ç”¨æˆ·æ³¨å†ŒæˆåŠŸ7å¤©åï¼Œå‘é€çŸ­ä¿¡é—®å€™</li></ol><p><strong>å®ç°æ–¹å¼</strong></p><ol><li><p>å®šæ—¶å™¨</p></li><li><p>å»¶è¿Ÿé˜Ÿåˆ—</p><p><img src="http://images.hellocode.top/2021061015222514.png" alt="" loading="lazy"></p></li></ol><p>å¾ˆå¯æƒœï¼Œåœ¨RabbitMQä¸­å¹¶æœªæä¾›å»¶è¿Ÿé˜Ÿåˆ—åŠŸèƒ½</p><p>ä½†æ˜¯å¯ä»¥ç”¨ï¼š<em>TTL+æ­»ä¿¡é˜Ÿåˆ—</em> ç»„åˆå®ç°å»¶è¿Ÿé˜Ÿåˆ—çš„æ•ˆæœ</p><p><img src="http://images.hellocode.top/20210610152606193.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><h4 id="æ—¥å¿—ä¸ç›‘æ§" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—ä¸ç›‘æ§" aria-hidden="true">#</a> æ—¥å¿—ä¸ç›‘æ§</h4><blockquote><p>è¿™éƒ¨åˆ†äº†è§£å³å¯</p></blockquote><p>RabbitMQé»˜è®¤æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼š<code>/var/log/rabbitmq/rabbit@xxx.log</code></p><p>è¿˜æœ‰ä¸€äº›ä¿¡æ¯å¯ä»¥åœ¨å¯è§†åŒ–ç•Œé¢15672ç•Œé¢æŸ¥çœ‹</p><p><strong>rabbitmqctlç®¡ç†å’Œç›‘æ§</strong></p><ul><li>æŸ¥çœ‹é˜Ÿåˆ—ï¼š<code>rabbitmqctl list_queues</code></li><li>æŸ¥çœ‹exchangesï¼š<code>rabbitmqctl list_exchanges</code></li><li>æŸ¥çœ‹ç”¨æˆ·ï¼š<code>rabbitmqctl list_users</code></li><li>æŸ¥çœ‹è¿æ¥ï¼š<code>rabbitmqctl list_connections</code></li><li>æŸ¥çœ‹æ¶ˆè´¹è€…ä¿¡æ¯ï¼š<code>rabbitmqctl list_consumer</code></li><li>æŸ¥çœ‹ç¯å¢ƒå˜é‡ï¼š<code>rabbitmqctl environment</code></li><li>æŸ¥çœ‹æœªè¢«ç¡®è®¤çš„é˜Ÿåˆ—ï¼š<code>rabbitmqctl list_queues name messages_unacknowledged</code></li><li>æŸ¥çœ‹å•ä¸ªé˜Ÿåˆ—çš„å†…å­˜ä½¿ç”¨ï¼š<code>rabbitmqctl list_queues name memory</code></li><li>æŸ¥çœ‹å‡†å¤‡å°±ç»ªçš„é˜Ÿåˆ—ï¼š<code>rabbitmqctl list_queues name messages_ready</code></li></ul><h4 id="æ¶ˆæ¯è¿½è¸ª" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯è¿½è¸ª" aria-hidden="true">#</a> æ¶ˆæ¯è¿½è¸ª</h4><p>åœ¨ä½¿ç”¨ä»»ä½•æ¶ˆæ¯ä¸­é—´ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œéš¾å…ä¼šå‡ºç°æŸæ¡æ¶ˆæ¯å¼‚å¸¸ä¸¢å¤±çš„æƒ…å†µã€‚å¯¹äºRabbitMQè€Œè¨€ï¼Œå¯èƒ½æ˜¯å› ä¸ºç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ä¸RabbitMQæ–­å¼€äº†è¿æ¥ï¼Œè€Œä»–ä»¬ä¸RabbitMQåˆé‡‡ç”¨äº†ä¸åŒçš„ç¡®è®¤æœºåˆ¶ï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯å› ä¸ºäº¤æ¢å™¨ä¸é˜Ÿåˆ—ä¹‹é—´ä¸åŒçš„è½¬å‘ç­–ç•¥ï¼›ç”šè‡³æ˜¯äº¤æ¢å™¨å¹¶æ²¡æœ‰ä¸ä»»ä½•é˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œç”Ÿäº§è€…åˆä¸æ„ŸçŸ¥æˆ–è€…æ²¡æœ‰é‡‡å–ç›¸åº”çš„æªæ–½ï¼›å¦å¤–RabbitMQæœ¬èº«çš„é›†ç¾¤ç­–ç•¥ä¹Ÿå¯èƒ½å¯¼è‡´æ¶ˆæ¯çš„ä¸¢å¤±ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æœ‰ä¸€ä¸ªè¾ƒå¥½çš„æœºåˆ¶è·Ÿè¸ªè®°å½•æ¶ˆæ¯çš„æŠ•é€’è¿‡ç¨‹ï¼Œä»¥æ­¤ååŠ©å¼€å‘å’Œè¿ç»´äººå‘˜è¿›è¡Œé—®é¢˜çš„å®šä½</p><p>åœ¨RabbitMQä¸­å¯ä»¥ä½¿ç”¨Firehoseå’Œrabbitmq_tracingæ’ä»¶åŠŸèƒ½æ¥å®ç°æ¶ˆæ¯è·Ÿè¸ª</p><p><strong>æ¶ˆæ¯è¿½è¸ª-Firehose</strong></p><p>firehoseçš„æœºåˆ¶æ˜¯å°†ç”Ÿäº§è€…æŠ•é€’ç»™rabbitmqçš„æ¶ˆæ¯,rabbitmqæŠ•é€’ç»™æ¶ˆè´¹è€…çš„æ¶ˆæ¯æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼å‘é€åˆ°é»˜è®¤çš„exchangeä¸Š.è¿™ä¸ªé»˜è®¤çš„exchangeçš„åç§°ä¸ºamq.rabbitmq.trace,å®ƒæ˜¯ä¸€ä¸ªtopicç±»å‹çš„exchange.å‘é€åˆ°è¿™ä¸ªexchangeä¸Šçš„æ¶ˆæ¯çš„routing keyä¸ºpublic.exchangenameå’Œdeliver.queuename.å…¶ä¸­exchangenameå’Œqueuenameä¸ºå®é™…exchangeå’Œqueueçš„åç§°.åˆ†åˆ«å¯¹åº”ç”Ÿäº§è€…æŠ•é€’åˆ°exchangeçš„æ¶ˆæ¯,å’Œæ¶ˆè´¹è€…ä»queueä¸Šè·å–çš„æ¶ˆæ¯.</p><p>æ³¨æ„:æ‰“å¼€traceä¼šå½±å“æ¶ˆæ¯å†™å…¥åŠŸèƒ½,é€‚å½“æ‰“å¼€åè¯·å…³é—­.ï¼ˆLinuxå‘½ä»¤ï¼‰</p><ul><li><p><code>rabbitmqctl trace_on</code>:å¼€å¯Firehoseå‘½ä»¤</p></li><li><p><code>rabbitmqctl trace_off</code>:å…³é—­Firehoseå‘½ä»¤</p></li></ul><p><strong>æ¶ˆæ¯è¿½è¸ª-rabbitmqq_tracing</strong> rabbitmq_tracingå’ŒFirehoseåœ¨å®ç°ä¸Šå¦‚å‡ºä¸€è¾™ï¼Œåªä¸è¿‡rabbitmq_tracingçš„æ–¹å¼æ¯”Firehoseå¤šäº†ä¸€å±‚GUIçš„åŒ…è£…ï¼Œæ›´å®¹æ˜“ä½¿ç”¨å’Œç®¡ç†</p><p>å¯ç”¨æ’ä»¶:<code>rabbitmq-plugins enable rabbitmq_tracing</code></p><blockquote><p>å¼€å‘é˜¶æ®µæ’é”™ä¼šæ–¹ä¾¿ä¸€äº›ï¼Œä½†æ˜¯ç”Ÿäº§ç¯å¢ƒéœ€è¦æ…ç”¨ï¼Œä¼šå½±å“æ€§èƒ½</p></blockquote><h3 id="åº”ç”¨é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨é—®é¢˜" aria-hidden="true">#</a> åº”ç”¨é—®é¢˜</h3><ol><li>æ¶ˆæ¯å¯é æ€§ä¿éšœ <ul><li>æ¶ˆæ¯è¡¥å¿æœºåˆ¶</li></ul></li><li>æ¶ˆæ¯å¹‚ç­‰æ€§ä¿éšœ <ul><li>ä¹è§‚é”è§£å†³æ–¹æ¡ˆ</li></ul></li></ol><h4 id="æ¶ˆæ¯è¡¥å¿" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯è¡¥å¿" aria-hidden="true">#</a> æ¶ˆæ¯è¡¥å¿</h4><p><strong>éœ€æ±‚</strong>ï¼š100%ç¡®ä¿æ¶ˆæ¯å‘é€æˆåŠŸ</p><p><em>æ–¹æ¡ˆå›¾ç¤ºï¼š</em></p><p><img src="http://images.hellocode.top/20200409102835144.png" alt="img" loading="lazy"></p><h4 id="å¹‚ç­‰æ€§ä¿éšœ" tabindex="-1"><a class="header-anchor" href="#å¹‚ç­‰æ€§ä¿éšœ" aria-hidden="true">#</a> å¹‚ç­‰æ€§ä¿éšœ</h4><p>å¹‚ç­‰æ€§æŒ‡ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºï¼Œå¯¹äºèµ„æºæœ¬èº«åº”è¯¥å…·æœ‰åŒæ ·çš„ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œå¯¹èµ„æºæœ¬èº«æ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒ</p><p>åœ¨MQä¸­æŒ‡ï¼Œæ¶ˆè´¹å¤šæ¡ç›¸åŒçš„æ¶ˆæ¯ï¼Œå¾—åˆ°ä¸æ¶ˆè´¹è¯¥æ¶ˆæ¯ä¸€æ¬¡ç›¸åŒçš„ç»“æœ</p><p><em>æ–¹æ¡ˆå›¾ç¤ºï¼ˆä¹è§‚é”æœºåˆ¶ï¼‰ï¼š</em></p><p><img src="http://images.hellocode.top/20200409102904789.png" alt="img" loading="lazy"></p><h3 id="é›†ç¾¤æ­å»º" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤æ­å»º" aria-hidden="true">#</a> é›†ç¾¤æ­å»º</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœåªæ˜¯ä¸ºäº†å­¦ä¹ RabbitMQæˆ–è€…éªŒè¯ä¸šåŠ¡å·¥ç¨‹çš„æ­£ç¡®æ€§é‚£ä¹ˆåœ¨æœ¬åœ°ç¯å¢ƒæˆ–è€…æµ‹è¯•ç¯å¢ƒä¸Šä½¿ç”¨å…¶å•å®ä¾‹éƒ¨ç½²å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å‡ºäºMQä¸­é—´ä»¶æœ¬èº«çš„å¯é æ€§ã€å¹¶å‘æ€§ã€ååé‡å’Œæ¶ˆæ¯å †ç§¯èƒ½åŠ›ç­‰é—®é¢˜çš„è€ƒè™‘ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸Šä¸€èˆ¬éƒ½ä¼šè€ƒè™‘ä½¿ç”¨RabbitMQçš„é›†ç¾¤æ–¹æ¡ˆã€‚</p><h4 id="é›†ç¾¤æ–¹æ¡ˆçš„åŸç†" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤æ–¹æ¡ˆçš„åŸç†" aria-hidden="true">#</a> é›†ç¾¤æ–¹æ¡ˆçš„åŸç†</h4><p>RabbitMQè¿™æ¬¾æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶äº§å“æœ¬èº«æ˜¯åŸºäºErlangç¼–å†™ï¼ŒErlangè¯­è¨€å¤©ç”Ÿå…·å¤‡åˆ†å¸ƒå¼ç‰¹æ€§ï¼ˆé€šè¿‡åŒæ­¥Erlangé›†ç¾¤å„èŠ‚ç‚¹çš„magic cookieæ¥å®ç°ï¼‰ã€‚å› æ­¤ï¼ŒRabbitMQå¤©ç„¶æ”¯æŒClusteringã€‚è¿™ä½¿å¾—RabbitMQæœ¬èº«ä¸éœ€è¦åƒActiveMQã€Kafkaé‚£æ ·é€šè¿‡ZooKeeperåˆ†åˆ«æ¥å®ç°HAæ–¹æ¡ˆå’Œä¿å­˜é›†ç¾¤çš„å…ƒæ•°æ®ã€‚é›†ç¾¤æ˜¯ä¿è¯å¯é æ€§çš„ä¸€ç§æ–¹å¼ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡æ°´å¹³æ‰©å±•ä»¥è¾¾åˆ°å¢åŠ æ¶ˆæ¯ååé‡èƒ½åŠ›çš„ç›®çš„ã€‚</p><p><img src="http://images.hellocode.top/1566073768274.png" alt="" loading="lazy"></p><h4 id="å•æœºå¤šå®ä¾‹éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#å•æœºå¤šå®ä¾‹éƒ¨ç½²" aria-hidden="true">#</a> å•æœºå¤šå®ä¾‹éƒ¨ç½²</h4><p>ç”±äºæŸäº›å› ç´ çš„é™åˆ¶ï¼Œæœ‰æ—¶å€™ä½ ä¸å¾—ä¸åœ¨ä¸€å°æœºå™¨ä¸Šå»æ­å»ºä¸€ä¸ªrabbitmqé›†ç¾¤ï¼Œè¿™ä¸ªæœ‰ç‚¹ç±»ä¼¼zookeeperçš„å•æœºç‰ˆã€‚çœŸå®ç”Ÿæˆç¯å¢ƒè¿˜æ˜¯è¦é…æˆå¤šæœºé›†ç¾¤çš„ã€‚æœ‰å…³æ€ä¹ˆé…ç½®å¤šæœºé›†ç¾¤çš„å¯ä»¥å‚è€ƒå…¶ä»–çš„èµ„æ–™ï¼Œè¿™é‡Œä¸»è¦è®ºè¿°å¦‚ä½•åœ¨å•æœºä¸­é…ç½®å¤šä¸ªrabbitmqå®ä¾‹ã€‚</p><p>ä¸»è¦å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.rabbitmq.com/clustering.html" target="_blank" rel="noopener noreferrer">https://www.rabbitmq.com/clustering.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ol><li><p>é¦–å…ˆç¡®ä¿RabbitMQè¿è¡Œæ²¡æœ‰é—®é¢˜ï¼š<code>rabbitmqctl status</code></p></li><li><p>åœæ­¢rabbitmqæœåŠ¡:<code>service rabbitmq-server stop</code></p></li><li><p>å¯åŠ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼š<code>RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit1 rabbitmq-server start</code></p></li><li><p>å¯åŠ¨ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼š<code>RABBITMQ_NODE_PORT=5674 RABBITMQ_SERVER_START_ARGS=&quot;-rabbitmq_management listener [{port,15674}]&quot; RABBITMQ_NODENAME=rabbit2 rabbitmq-server start</code></p></li></ol><blockquote><p>webç®¡ç†æ’ä»¶ç«¯å£å ç”¨,æ‰€ä»¥è¿˜è¦æŒ‡å®šå…¶webæ’ä»¶å ç”¨çš„ç«¯å£å·ã€‚</p></blockquote><p>ç»“æŸå‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rabbitmqctl <span class="token parameter variable">-n</span> rabbit1 stop
rabbitmqctl <span class="token parameter variable">-n</span> rabbit2 stop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>rabbit1æ“ä½œä½œä¸ºä¸»èŠ‚ç‚¹ï¼š</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rabbitmqctl <span class="token parameter variable">-n</span> rabbit1 stop_app
rabbitmqctl <span class="token parameter variable">-n</span> rabbit1 reset
rabbitmqctl <span class="token parameter variable">-n</span> rabbit1 start_app
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>rabbit2æ“ä½œä¸ºä»èŠ‚ç‚¹ï¼š</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rabbitmqctl <span class="token parameter variable">-n</span> rabbit2 stop_app
rabbitmqctl <span class="token parameter variable">-n</span> rabbit2 reset
rabbitmqctl <span class="token parameter variable">-n</span> rabbit2 join_cluster rabbit1@<span class="token string">&#39;super&#39;</span> 	<span class="token comment"># &#39;&#39;å†…æ˜¯ä¸»æœºåæ¢æˆè‡ªå·±çš„</span>
rabbitmqctl <span class="token parameter variable">-n</span> rabbit2 start_app
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="7"><li><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š<code>rabbitmqctl cluster_status -n rabbit1</code></p></li><li><p>webç›‘æ§ï¼š</p></li></ol><p><img src="http://images.hellocode.top/1566065096459.png" alt="" loading="lazy"></p><blockquote><p>æ­¤æ—¶é›†ç¾¤å·²ç»æ­å»ºå®Œæˆï¼Œä½†æ˜¯æ•°æ®å¹¶æœªåŒæ­¥ï¼Œå¦‚æœå‘ä¸»èŠ‚ç‚¹é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œå†å°†ä¸»èŠ‚ç‚¹åœæ­¢ï¼Œä»èŠ‚ç‚¹å°†æ— æ³•è·å–é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œæ˜¾ç¤ºNAN</p><p>è¦è§£å†³æ­¤é—®é¢˜ï¼Œéœ€è¦é•œåƒé˜Ÿåˆ—æ¥å¤„ç†</p></blockquote><h4 id="é›†ç¾¤ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤ç®¡ç†" aria-hidden="true">#</a> é›†ç¾¤ç®¡ç†</h4><p><code>rabbitmqctl join_cluster {cluster_node} [â€“ram]</code> å°†èŠ‚ç‚¹åŠ å…¥æŒ‡å®šé›†ç¾¤ä¸­ã€‚åœ¨è¿™ä¸ªå‘½ä»¤æ‰§è¡Œå‰éœ€è¦åœæ­¢RabbitMQåº”ç”¨å¹¶é‡ç½®èŠ‚ç‚¹ã€‚</p><p><code>rabbitmqctl cluster_status</code> æ˜¾ç¤ºé›†ç¾¤çš„çŠ¶æ€ã€‚</p><p><code>rabbitmqctl change_cluster_node_type {disc|ram}</code> ä¿®æ”¹é›†ç¾¤èŠ‚ç‚¹çš„ç±»å‹ã€‚åœ¨è¿™ä¸ªå‘½ä»¤æ‰§è¡Œå‰éœ€è¦åœæ­¢RabbitMQåº”ç”¨ã€‚</p><p><code>rabbitmqctl forget_cluster_node [â€“offline]</code> å°†èŠ‚ç‚¹ä»é›†ç¾¤ä¸­åˆ é™¤ï¼Œå…è®¸ç¦»çº¿æ‰§è¡Œã€‚</p><p><code>rabbitmqctl update_cluster_nodes {clusternode}</code></p><p>åœ¨é›†ç¾¤ä¸­çš„èŠ‚ç‚¹åº”ç”¨å¯åŠ¨å‰å’¨è¯¢clusternodeèŠ‚ç‚¹çš„æœ€æ–°ä¿¡æ¯ï¼Œå¹¶æ›´æ–°ç›¸åº”çš„é›†ç¾¤ä¿¡æ¯ã€‚è¿™ä¸ªå’Œjoin_clusterä¸åŒï¼Œå®ƒä¸åŠ å…¥é›†ç¾¤ã€‚è€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼ŒèŠ‚ç‚¹Aå’ŒèŠ‚ç‚¹Béƒ½åœ¨é›†ç¾¤ä¸­ï¼Œå½“èŠ‚ç‚¹Aç¦»çº¿äº†ï¼ŒèŠ‚ç‚¹Cåˆå’ŒèŠ‚ç‚¹Bç»„æˆäº†ä¸€ä¸ªé›†ç¾¤ï¼Œç„¶åèŠ‚ç‚¹Båˆç¦»å¼€äº†é›†ç¾¤ï¼Œå½“Aé†’æ¥çš„æ—¶å€™ï¼Œå®ƒä¼šå°è¯•è”ç³»èŠ‚ç‚¹Bï¼Œä½†æ˜¯è¿™æ ·ä¼šå¤±è´¥ï¼Œå› ä¸ºèŠ‚ç‚¹Bå·²ç»ä¸åœ¨é›†ç¾¤ä¸­äº†ã€‚</p><p><code>rabbitmqctl cancel_sync_queue [-p vhost] {queue}</code> å–æ¶ˆé˜Ÿåˆ—queueåŒæ­¥é•œåƒçš„æ“ä½œã€‚</p><p><code>rabbitmqctl set_cluster_name {name}</code> è®¾ç½®é›†ç¾¤åç§°ã€‚é›†ç¾¤åç§°åœ¨å®¢æˆ·ç«¯è¿æ¥æ—¶ä¼šé€šæŠ¥ç»™å®¢æˆ·ç«¯ã€‚Federationå’ŒShovelæ’ä»¶ä¹Ÿä¼šæœ‰ç”¨åˆ°é›†ç¾¤åç§°çš„åœ°æ–¹ã€‚é›†ç¾¤åç§°é»˜è®¤æ˜¯é›†ç¾¤ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„åç§°ï¼Œé€šè¿‡è¿™ä¸ªå‘½ä»¤å¯ä»¥é‡æ–°è®¾ç½®ã€‚</p><h4 id="rabbitmqé•œåƒé›†ç¾¤é…ç½®" tabindex="-1"><a class="header-anchor" href="#rabbitmqé•œåƒé›†ç¾¤é…ç½®" aria-hidden="true">#</a> RabbitMQé•œåƒé›†ç¾¤é…ç½®</h4><blockquote><p>ä¸Šé¢å·²ç»å®ŒæˆRabbitMQé»˜è®¤é›†ç¾¤æ¨¡å¼ï¼Œä½†å¹¶ä¸ä¿è¯é˜Ÿåˆ—çš„é«˜å¯ç”¨æ€§ï¼Œå°½ç®¡äº¤æ¢æœºã€ç»‘å®šè¿™äº›å¯ä»¥å¤åˆ¶åˆ°é›†ç¾¤é‡Œçš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯é˜Ÿåˆ—å†…å®¹ä¸ä¼šå¤åˆ¶ã€‚è™½ç„¶è¯¥æ¨¡å¼è§£å†³ä¸€é¡¹ç›®ç»„èŠ‚ç‚¹å‹åŠ›ï¼Œä½†é˜Ÿåˆ—èŠ‚ç‚¹å®•æœºç›´æ¥å¯¼è‡´è¯¥é˜Ÿåˆ—æ— æ³•åº”ç”¨ï¼Œåªèƒ½ç­‰å¾…é‡å¯ï¼Œæ‰€ä»¥è¦æƒ³åœ¨é˜Ÿåˆ—èŠ‚ç‚¹å®•æœºæˆ–æ•…éšœä¹Ÿèƒ½æ­£å¸¸åº”ç”¨ï¼Œå°±è¦å¤åˆ¶é˜Ÿåˆ—å†…å®¹åˆ°é›†ç¾¤é‡Œçš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå¿…é¡»è¦åˆ›å»ºé•œåƒé˜Ÿåˆ—ã€‚</p><p>é•œåƒé˜Ÿåˆ—æ˜¯åŸºäºæ™®é€šçš„é›†ç¾¤æ¨¡å¼çš„ï¼Œç„¶åå†æ·»åŠ ä¸€äº›ç­–ç•¥ï¼Œæ‰€ä»¥ä½ è¿˜æ˜¯å¾—å…ˆé…ç½®æ™®é€šé›†ç¾¤ï¼Œç„¶åæ‰èƒ½è®¾ç½®é•œåƒé˜Ÿåˆ—ï¼Œæˆ‘ä»¬å°±ä»¥ä¸Šé¢çš„é›†ç¾¤æ¥ç€åšã€‚</p></blockquote><p><em>è®¾ç½®çš„é•œåƒé˜Ÿåˆ—å¯ä»¥é€šè¿‡å¼€å¯çš„ç½‘é¡µçš„ç®¡ç†ç«¯Admin-&gt;Policiesï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤</em></p><blockquote><p><code>rabbitmqctl set_policy my_ha &quot;^&quot; &#39;{&quot;ha-mode&quot;:&quot;all&quot;}&#39;</code></p></blockquote><p><img src="http://images.hellocode.top/1566072300852.png" alt="" loading="lazy"></p><blockquote><ul><li>Name:ç­–ç•¥åç§°</li><li>Patternï¼šåŒ¹é…çš„è§„åˆ™ï¼Œå¦‚æœæ˜¯åŒ¹é…æ‰€æœ‰çš„é˜Ÿåˆ—ï¼Œæ˜¯<code>^</code></li><li>Definition:ä½¿ç”¨ha-modeæ¨¡å¼ä¸­çš„allï¼Œä¹Ÿå°±æ˜¯åŒæ­¥æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ã€‚é—®å·é“¾æ¥å¸®åŠ©æ–‡æ¡£ã€‚</li></ul></blockquote><h4 id="è´Ÿè½½å‡è¡¡-haproxy" tabindex="-1"><a class="header-anchor" href="#è´Ÿè½½å‡è¡¡-haproxy" aria-hidden="true">#</a> è´Ÿè½½å‡è¡¡-HAProxy</h4><p>HAProxyæä¾›é«˜å¯ç”¨æ€§ã€è´Ÿè½½å‡è¡¡ä»¥åŠåŸºäºTCPå’ŒHTTPåº”ç”¨çš„ä»£ç†ï¼Œæ”¯æŒè™šæ‹Ÿä¸»æœºï¼Œå®ƒæ˜¯å…è´¹ã€å¿«é€Ÿå¹¶ä¸”å¯é çš„ä¸€ç§è§£å†³æ–¹æ¡ˆ,åŒ…æ‹¬Twitterï¼ŒRedditï¼ŒStackOverflowï¼ŒGitHubåœ¨å†…çš„å¤šå®¶çŸ¥åäº’è”ç½‘å…¬å¸åœ¨ä½¿ç”¨ã€‚HAProxyå®ç°äº†ä¸€ç§äº‹ä»¶é©±åŠ¨ã€å•ä¸€è¿›ç¨‹æ¨¡å‹ï¼Œæ­¤æ¨¡å‹æ”¯æŒéå¸¸å¤§çš„å¹¶å‘è¿æ¥æ•°ã€‚</p><h5 id="å®‰è£…haproxy" tabindex="-1"><a class="header-anchor" href="#å®‰è£…haproxy" aria-hidden="true">#</a> å®‰è£…HAProxy</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># ä¸‹è½½ä¾èµ–åŒ…</span>
yum <span class="token function">install</span> gcc <span class="token function">vim</span> <span class="token function">wget</span>

<span class="token comment"># ä¸Šä¼ haproxyæºç åŒ…</span>

<span class="token comment"># è§£å‹</span>
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> haproxy-1.6.5.tar.gz <span class="token parameter variable">-C</span> /usr/local

<span class="token comment"># è¿›å…¥ç›®å½•ã€è¿›è¡Œç¼–è¯‘ã€å®‰è£…</span>
<span class="token builtin class-name">cd</span> /usr/local/haproxy-1.6.5
<span class="token function">make</span> <span class="token assign-left variable">TARGET</span><span class="token operator">=</span>linux31 <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span>/usr/local/haproxy
<span class="token function">make</span> <span class="token function">install</span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span>/usr/local/haproxy

<span class="token comment"># èµ‹æƒ</span>
<span class="token function">groupadd</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-g</span> <span class="token number">149</span> haproxy
<span class="token function">useradd</span> <span class="token parameter variable">-g</span> haproxy <span class="token parameter variable">-r</span> <span class="token parameter variable">-s</span> /sbin/nologin <span class="token parameter variable">-u</span> <span class="token number">149</span> haproxy

<span class="token comment"># åˆ›å»ºhaproxyé…ç½®æ–‡ä»¶</span>
<span class="token function">mkdir</span> /etc/haproxy
<span class="token function">vim</span> /etc/haproxy/haproxy.cfg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="é…ç½®haproxy" tabindex="-1"><a class="header-anchor" href="#é…ç½®haproxy" aria-hidden="true">#</a> é…ç½®HAProxy</h5><p>é…ç½®æ–‡ä»¶è·¯å¾„ï¼š/etc/haproxy/haproxy.cfg</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#logging options</span>
global
	log <span class="token number">127.0</span>.0.1 local0 info
	maxconn <span class="token number">5120</span>
	<span class="token function">chroot</span> /usr/local/haproxy
	uid <span class="token number">99</span>
	gid <span class="token number">99</span>
	daemon
	quiet
	nbproc <span class="token number">20</span>
	pidfile /var/run/haproxy.pid

defaults
	log global
	
	mode tcp

	option tcplog
	option dontlognull
	retries <span class="token number">3</span>
	option redispatch
	maxconn <span class="token number">2000</span>
	contimeout 5s
   
     clitimeout 60s

     srvtimeout 15s	
<span class="token comment">#front-end IP for consumers and producters</span>

listen rabbitmq_cluster
	<span class="token builtin class-name">bind</span> <span class="token number">0.0</span>.0.0:5672
	
	mode tcp
	<span class="token comment">#balance url_param userid</span>
	<span class="token comment">#balance url_param session_id check_post 64</span>
	<span class="token comment">#balance hdr(User-Agent)</span>
	<span class="token comment">#balance hdr(host)</span>
	<span class="token comment">#balance hdr(Host) use_domain_only</span>
	<span class="token comment">#balance rdp-cookie</span>
	<span class="token comment">#balance leastconn</span>
	<span class="token comment">#balance source //ip</span>
	
	balance roundrobin
	
        server node1 <span class="token number">127.0</span>.0.1:5673 check inter <span class="token number">5000</span> rise <span class="token number">2</span> fall <span class="token number">2</span>
        server node2 <span class="token number">127.0</span>.0.1:5674 check inter <span class="token number">5000</span> rise <span class="token number">2</span> fall <span class="token number">2</span>

listen stats
	<span class="token builtin class-name">bind</span> <span class="token number">192.168</span>.23.129:8100
	mode http
	option httplog
	stats <span class="token builtin class-name">enable</span>
	stats uri /rabbitmq-stats
	stats refresh 5s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨HAproxyè´Ÿè½½</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/haproxy/sbin/haproxy <span class="token parameter variable">-f</span> /etc/haproxy/haproxy.cfg
//æŸ¥çœ‹haproxyè¿›ç¨‹çŠ¶æ€
<span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> haproxy

è®¿é—®å¦‚ä¸‹åœ°å€å¯¹mqèŠ‚ç‚¹è¿›è¡Œç›‘æ§
http://192.168.23.129:8100/rabbitmq-stats
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç ä¸­è®¿é—®mqé›†ç¾¤åœ°å€ï¼Œåˆ™å˜ä¸ºè®¿é—®haproxyåœ°å€:5672</p><p><strong>é›†ç¾¤ä»£ç å…¥é—¨</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span><span class="token class-name">TimeoutException</span><span class="token punctuation">{</span>
        <span class="token comment">// 1. åˆ›å»ºè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.23.129&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//HaProxy ip</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// HaProxy ç«¯å£</span>
        <span class="token comment">// 3. åˆ›å»ºè¿æ¥Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span>`<span class="token punctuation">;</span>
        <span class="token comment">// 4. åˆ›å»ºchannel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. åˆ›å»ºé˜Ÿåˆ—Queue</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;hello_world&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token string">&quot;hello rabbitmq~&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 6. å‘é€æ¶ˆæ¯</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello_world&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7. é‡Šæ”¾èµ„æº</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;send success...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/HelloCode66/Java-Navigation/edit/main/src/md/frame/rabbitmq.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><!----><!----></footer><nav class="page-nav"><a href="/md/frame/zookeeper.html" class="nav-link prev" aria-label="Zookeeper"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Zookeeper</div></a><a href="/md/frame/interview.html" class="nav-link next" aria-label="é¢è¯•å®å…¸"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">é¢è¯•å®å…¸<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">é»˜è®¤é¡µè„š</div><div class="copyright">Copyright Â© 2022 HelloCode.</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.69e51fc3.js" defer></script>
  </body>
</html>
